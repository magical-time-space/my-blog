<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.61" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://mpbug.gitee.io/views/Books/Front-end/JustVue2/reactive/props.html"><meta property="og:site_name" content="魔法Bug"><meta property="og:title" content="Props (v2.6.11)"><meta property="og:description" content="Props (v2.6.11) Props 作为组件的核心特性之一，也是我们平时开发 Vue 项目中接触最多的特性之一，它可以让组件的功能变得丰富，也是父子组件通讯的一个渠道。那么它的实现原理是怎样的，我们来一探究竟。 规范化 在初始化 props 之前，首先会对 props 做一次 normalize，它发生在 mergeOptions 的时候，在 src/core/util/options.js 中："><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="魔法时空宝库"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Props (v2.6.11)","image":[""],"dateModified":null,"author":[{"@type":"Person","name":"魔法时空宝库","url":"https://mpbug.gitee.io/player/"}]}</script><title>Props (v2.6.11) | 魔法Bug</title><meta name="description" content="Props (v2.6.11) Props 作为组件的核心特性之一，也是我们平时开发 Vue 项目中接触最多的特性之一，它可以让组件的功能变得丰富，也是父子组件通讯的一个渠道。那么它的实现原理是怎样的，我们来一探究竟。 规范化 在初始化 props 之前，首先会对 props 做一次 normalize，它发生在 mergeOptions 的时候，在 src/core/util/options.js 中：">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-1755d5ce.css" as="style"><link rel="stylesheet" href="/assets/style-1755d5ce.css">
    <link rel="modulepreload" href="/assets/app-724d8966.js"><link rel="modulepreload" href="/assets/framework-d8252107.js"><link rel="modulepreload" href="/assets/props.html-5626af6b.js"><link rel="modulepreload" href="/assets/props.html-7bc69771.js"><link rel="prefetch" href="/assets/index.html-addc0ce4.js" as="script"><link rel="prefetch" href="/assets/intro.html-86d922dd.js" as="script"><link rel="prefetch" href="/assets/slides.html-7db34244.js" as="script"><link rel="prefetch" href="/assets/slidesOld.html-2f396fe5.js" as="script"><link rel="prefetch" href="/assets/index.html-872a68ad.js" as="script"><link rel="prefetch" href="/assets/mg.html-c0025bc1.js" as="script"><link rel="prefetch" href="/assets/mg.html-b3d5c19f.js" as="script"><link rel="prefetch" href="/assets/index.html-70a81eac.js" as="script"><link rel="prefetch" href="/assets/中华田园文化.html-851a46e4.js" as="script"><link rel="prefetch" href="/assets/NormalDay.html-97f6245e.js" as="script"><link rel="prefetch" href="/assets/index.html-c92940b6.js" as="script"><link rel="prefetch" href="/assets/争与不争.html-53c904c0.js" as="script"><link rel="prefetch" href="/assets/和气生财.html-6f61e47c.js" as="script"><link rel="prefetch" href="/assets/闷声发大财.html-38c1f0c2.js" as="script"><link rel="prefetch" href="/assets/index.html-1d8c7134.js" as="script"><link rel="prefetch" href="/assets/github.html-4ad21375.js" as="script"><link rel="prefetch" href="/assets/高速摄像头资源.html-6f3a8865.js" as="script"><link rel="prefetch" href="/assets/浏览器收藏夹-脚本.html-3c297cf1.js" as="script"><link rel="prefetch" href="/assets/course.html-c1d46c99.js" as="script"><link rel="prefetch" href="/assets/index.html-68f040f1.js" as="script"><link rel="prefetch" href="/assets/me.html-7d031bfa.js" as="script"><link rel="prefetch" href="/assets/index.html-41851142.js" as="script"><link rel="prefetch" href="/assets/index.html-bbbccc6d.js" as="script"><link rel="prefetch" href="/assets/基础知识：配色原理.html-40d335fe.js" as="script"><link rel="prefetch" href="/assets/背景知识：色学发展时间表.html-43f7121d.js" as="script"><link rel="prefetch" href="/assets/课程知识：颜色科学.html-9209370a.js" as="script"><link rel="prefetch" href="/assets/Setting.html-6c87dd6b.js" as="script"><link rel="prefetch" href="/assets/Snippets.html-9b428701.js" as="script"><link rel="prefetch" href="/assets/程序员常用英语词汇.html-1d3c642f.js" as="script"><link rel="prefetch" href="/assets/计算机编程及常用术语英语词汇大全.html-16007e53.js" as="script"><link rel="prefetch" href="/assets/1114路由器默认密码.html-c6861754.js" as="script"><link rel="prefetch" href="/assets/dism安装脚本.html-ba9c8eac.js" as="script"><link rel="prefetch" href="/assets/ChromeExtension.html-4c313a0a.js" as="script"><link rel="prefetch" href="/assets/Git with SSH.html-de681400.js" as="script"><link rel="prefetch" href="/assets/AI工具.html-56133034.js" as="script"><link rel="prefetch" href="/assets/时空葫芦工具箱.html-8ebb991e.js" as="script"><link rel="prefetch" href="/assets/音乐番茄果果果.html-ada18b1b.js" as="script"><link rel="prefetch" href="/assets/《周公解梦》.html-3d0c3038.js" as="script"><link rel="prefetch" href="/assets/《敦煌本梦书》.html-4a7d3c98.js" as="script"><link rel="prefetch" href="/assets/《断梦秘书》.html-eeaf23fb.js" as="script"><link rel="prefetch" href="/assets/《入药镜》.html-3d6b0ce3.js" as="script"><link rel="prefetch" href="/assets/index.html-a71af805.js" as="script"><link rel="prefetch" href="/assets/一般广告违禁词.html-fcdec837.js" as="script"><link rel="prefetch" href="/assets/中华人民共和国广告法.html-2de68e4a.js" as="script"><link rel="prefetch" href="/assets/互联网广告管理办法.html-ee9737f2.js" as="script"><link rel="prefetch" href="/assets/index.html-c2cf9b1a.js" as="script"><link rel="prefetch" href="/assets/中华人民共和国著作权法（2020）.html-69cfbbb0.js" as="script"><link rel="prefetch" href="/assets/中国版权保护中心著作权自愿登记收费标准.html-90de4638.js" as="script"><link rel="prefetch" href="/assets/index.html-eeb4af03.js" as="script"><link rel="prefetch" href="/assets/disrupt.html-d7247a4d.js" as="script"><link rel="prefetch" href="/assets/lane.html-cede7741.js" as="script"><link rel="prefetch" href="/assets/prepare.html-3546f72b.js" as="script"><link rel="prefetch" href="/assets/scheduler.html-adbd7c59.js" as="script"><link rel="prefetch" href="/assets/multi.html-2e47714e.js" as="script"><link rel="prefetch" href="/assets/one.html-866a3d7b.js" as="script"><link rel="prefetch" href="/assets/prepare.html-c062468f.js" as="script"><link rel="prefetch" href="/assets/create.html-9603f579.js" as="script"><link rel="prefetch" href="/assets/prepare.html-a14a2769.js" as="script"><link rel="prefetch" href="/assets/structure.html-5811dc49.js" as="script"><link rel="prefetch" href="/assets/useeffect.html-fbeb16cf.js" as="script"><link rel="prefetch" href="/assets/usememo.html-b668d622.js" as="script"><link rel="prefetch" href="/assets/useref.html-e532600b.js" as="script"><link rel="prefetch" href="/assets/usestate.html-43316131.js" as="script"><link rel="prefetch" href="/assets/file.html-5ba73d91.js" as="script"><link rel="prefetch" href="/assets/idea.html-5ac4f97d.js" as="script"><link rel="prefetch" href="/assets/jsx.html-3d928293.js" as="script"><link rel="prefetch" href="/assets/newConstructure.html-cceabde0.js" as="script"><link rel="prefetch" href="/assets/oldConstructure.html-6fa3115f.js" as="script"><link rel="prefetch" href="/assets/source.html-c019a563.js" as="script"><link rel="prefetch" href="/assets/summary.html-0a6c8100.js" as="script"><link rel="prefetch" href="/assets/beginWork.html-45bc5f39.js" as="script"><link rel="prefetch" href="/assets/completeWork.html-91fecc21.js" as="script"><link rel="prefetch" href="/assets/doubleBuffer.html-b0935f8f.js" as="script"><link rel="prefetch" href="/assets/fiber-mental.html-1bc7e55a.js" as="script"><link rel="prefetch" href="/assets/fiber.html-45d5764f.js" as="script"><link rel="prefetch" href="/assets/reconciler.html-b2924ace.js" as="script"><link rel="prefetch" href="/assets/beforeMutation.html-16341311.js" as="script"><link rel="prefetch" href="/assets/layout.html-04309b44.js" as="script"><link rel="prefetch" href="/assets/mutation.html-5dabbbb5.js" as="script"><link rel="prefetch" href="/assets/prepare.html-3211d06c.js" as="script"><link rel="prefetch" href="/assets/mental.html-a4853a34.js" as="script"><link rel="prefetch" href="/assets/prepare.html-95fa0e6c.js" as="script"><link rel="prefetch" href="/assets/priority.html-bb8f6ee0.js" as="script"><link rel="prefetch" href="/assets/reactdom.html-73a96dc8.js" as="script"><link rel="prefetch" href="/assets/setstate.html-eb0b7436.js" as="script"><link rel="prefetch" href="/assets/update.html-1f2f08e3.js" as="script"><link rel="prefetch" href="/assets/codegen.html-15e2ddec.js" as="script"><link rel="prefetch" href="/assets/entrance.html-83fee51d.js" as="script"><link rel="prefetch" href="/assets/index.html-d7856c62.js" as="script"><link rel="prefetch" href="/assets/optimize.html-de2eb9b5.js" as="script"><link rel="prefetch" href="/assets/parse.html-6acdbb35.js" as="script"><link rel="prefetch" href="/assets/async-component.html-69322b5c.js" as="script"><link rel="prefetch" href="/assets/component-register.html-ed46fd4a.js" as="script"><link rel="prefetch" href="/assets/create-component.html-f5559572.js" as="script"><link rel="prefetch" href="/assets/index.html-7b897ecc.js" as="script"><link rel="prefetch" href="/assets/lifecycle.html-2cf05d1b.js" as="script"><link rel="prefetch" href="/assets/merge-option.html-94ea7cc9.js" as="script"><link rel="prefetch" href="/assets/patch.html-4574b1c4.js" as="script"><link rel="prefetch" href="/assets/create-element.html-bd5a9968.js" as="script"><link rel="prefetch" href="/assets/index.html-ecf57dc4.js" as="script"><link rel="prefetch" href="/assets/mounted.html-c376f823.js" as="script"><link rel="prefetch" href="/assets/new-vue.html-176dd059.js" as="script"><link rel="prefetch" href="/assets/render.html-2450be2c.js" as="script"><link rel="prefetch" href="/assets/update.html-bf28ba9f.js" as="script"><link rel="prefetch" href="/assets/virtual-dom.html-3447b9e3.js" as="script"><link rel="prefetch" href="/assets/event.html-ccd24b90.js" as="script"><link rel="prefetch" href="/assets/index.html-61eb365b.js" as="script"><link rel="prefetch" href="/assets/keep-alive.html-9f4ec5d4.js" as="script"><link rel="prefetch" href="/assets/slot.html-a0e481b9.js" as="script"><link rel="prefetch" href="/assets/tansition-group.html-e27c4660.js" as="script"><link rel="prefetch" href="/assets/tansition.html-51c5a387.js" as="script"><link rel="prefetch" href="/assets/v-model.html-b24e8e34.js" as="script"><link rel="prefetch" href="/assets/build.html-3c50fd31.js" as="script"><link rel="prefetch" href="/assets/directory.html-67f49f0e.js" as="script"><link rel="prefetch" href="/assets/entrance.html-be82b143.js" as="script"><link rel="prefetch" href="/assets/flow.html-b089c19c.js" as="script"><link rel="prefetch" href="/assets/index.html-482f121e.js" as="script"><link rel="prefetch" href="/assets/component-update.html-d00a8089.js" as="script"><link rel="prefetch" href="/assets/computed-watcher.html-43eed0d1.js" as="script"><link rel="prefetch" href="/assets/getters.html-95a35379.js" as="script"><link rel="prefetch" href="/assets/index.html-1184c68a.js" as="script"><link rel="prefetch" href="/assets/next-tick.html-4e0ed553.js" as="script"><link rel="prefetch" href="/assets/questions.html-bd6d9094.js" as="script"><link rel="prefetch" href="/assets/reactive-object.html-97ed8726.js" as="script"><link rel="prefetch" href="/assets/setters.html-c5d76f6b.js" as="script"><link rel="prefetch" href="/assets/summary.html-62653e09.js" as="script"><link rel="prefetch" href="/assets/index.html-410922b4.js" as="script"><link rel="prefetch" href="/assets/install.html-4e71ca65.js" as="script"><link rel="prefetch" href="/assets/matcher.html-7b380ac8.js" as="script"><link rel="prefetch" href="/assets/router.html-94efd1ad.js" as="script"><link rel="prefetch" href="/assets/transition-to.html-cb838d9a.js" as="script"><link rel="prefetch" href="/assets/api.html-bd6166a0.js" as="script"><link rel="prefetch" href="/assets/index.html-f6e88c60.js" as="script"><link rel="prefetch" href="/assets/init.html-7454a41e.js" as="script"><link rel="prefetch" href="/assets/plugin.html-f7f4e411.js" as="script"><link rel="prefetch" href="/assets/ast.html-378b379f.js" as="script"><link rel="prefetch" href="/assets/binder.html-5802fab7.js" as="script"><link rel="prefetch" href="/assets/checker.html-0664c439.js" as="script"><link rel="prefetch" href="/assets/emitter.html-b42b0689.js" as="script"><link rel="prefetch" href="/assets/overview.html-2b6f5ec3.js" as="script"><link rel="prefetch" href="/assets/parser.html-45b8186f.js" as="script"><link rel="prefetch" href="/assets/program.html-9d19302c.js" as="script"><link rel="prefetch" href="/assets/scanner.html-192076ab.js" as="script"><link rel="prefetch" href="/assets/common.html-a8627d3a.js" as="script"><link rel="prefetch" href="/assets/interpreting.html-d828600b.js" as="script"><link rel="prefetch" href="/assets/class.html-e99c3769.js" as="script"><link rel="prefetch" href="/assets/commandline-behavior.html-9ea13d60.js" as="script"><link rel="prefetch" href="/assets/comments.html-e64f20fd.js" as="script"><link rel="prefetch" href="/assets/common-bug-not-bugs.html-caa8a65f.js" as="script"><link rel="prefetch" href="/assets/common-feature-request.html-f7dc98df.js" as="script"><link rel="prefetch" href="/assets/decorators.html-8fb9baed.js" as="script"><link rel="prefetch" href="/assets/enums.html-af9ad7cd.js" as="script"><link rel="prefetch" href="/assets/function.html-2d62c8e4.js" as="script"><link rel="prefetch" href="/assets/generics.html-cc0b0e0a.js" as="script"><link rel="prefetch" href="/assets/glossary-and-terms.html-f6a931bf.js" as="script"><link rel="prefetch" href="/assets/jsx-and-react.html-89bb9d8a.js" as="script"><link rel="prefetch" href="/assets/modules.html-5c1cf89e.js" as="script"><link rel="prefetch" href="/assets/thing-that-dont-work.html-37ea0cba.js" as="script"><link rel="prefetch" href="/assets/tsconfig-behavior.html-525b9c3e.js" as="script"><link rel="prefetch" href="/assets/type-guards.html-a6ed0548.js" as="script"><link rel="prefetch" href="/assets/type-system-behavior.html-97755d6f.js" as="script"><link rel="prefetch" href="/assets/nonReactJSX.html-cfefe2a5.js" as="script"><link rel="prefetch" href="/assets/reactJSX.html-1cfd37f7.js" as="script"><link rel="prefetch" href="/assets/support.html-c282d4fb.js" as="script"><link rel="prefetch" href="/assets/typescript-3.7.html-316db639.js" as="script"><link rel="prefetch" href="/assets/typescript-3.8.html-2b46055c.js" as="script"><link rel="prefetch" href="/assets/typescript-3.9.html-bec3bc12.js" as="script"><link rel="prefetch" href="/assets/compilationContext.html-dc1ef112.js" as="script"><link rel="prefetch" href="/assets/declarationspaces.html-afe66779.js" as="script"><link rel="prefetch" href="/assets/dynamicImportExpressions.html-c09ef21a.js" as="script"><link rel="prefetch" href="/assets/modules.html-f5fc9af5.js" as="script"><link rel="prefetch" href="/assets/namespaces.html-65ad7872.js" as="script"><link rel="prefetch" href="/assets/avoidExportDefault.html-159c85c1.js" as="script"><link rel="prefetch" href="/assets/barrel.html-2f7c72f6.js" as="script"><link rel="prefetch" href="/assets/bind.html-10be9ab1.js" as="script"><link rel="prefetch" href="/assets/buildToggles.html-43c46f2c.js" as="script"><link rel="prefetch" href="/assets/classAreUseful.html-858036fb.js" as="script"><link rel="prefetch" href="/assets/covarianceAndContravariance.html-b2049264.js" as="script"><link rel="prefetch" href="/assets/createArrays.html-f59314a1.js" as="script"><link rel="prefetch" href="/assets/curry.html-e4e6c844.js" as="script"><link rel="prefetch" href="/assets/functionParameters.html-4d3578a3.js" as="script"><link rel="prefetch" href="/assets/infer.html-4dc5d9dc.js" as="script"><link rel="prefetch" href="/assets/lazyObjectLiteralInitialization.html-9c16444a.js" as="script"><link rel="prefetch" href="/assets/limitPropertySetters.html-94133da7.js" as="script"><link rel="prefetch" href="/assets/metadata.html-3e371450.js" as="script"><link rel="prefetch" href="/assets/nominalTyping.html-dca5c8e5.js" as="script"><link rel="prefetch" href="/assets/outFileCaution.html-571cccaa.js" as="script"><link rel="prefetch" href="/assets/singletonPatern.html-6b137eec.js" as="script"><link rel="prefetch" href="/assets/statefulFunctions.html-ef94f425.js" as="script"><link rel="prefetch" href="/assets/staticConstructors.html-5e683034.js" as="script"><link rel="prefetch" href="/assets/stringBasedEmuns.html-c0557a31.js" as="script"><link rel="prefetch" href="/assets/truthy.html-6f0ff5e4.js" as="script"><link rel="prefetch" href="/assets/typeInstantiation.html-9f6bfd31.js" as="script"><link rel="prefetch" href="/assets/typesafeEventEmitter.html-ea81348a.js" as="script"><link rel="prefetch" href="/assets/ambient.html-bff6b50b.js" as="script"><link rel="prefetch" href="/assets/callable.html-e8ee0ea6.js" as="script"><link rel="prefetch" href="/assets/discrominatedUnion.html-2b43e7e7.js" as="script"><link rel="prefetch" href="/assets/enums.html-51aa068f.js" as="script"><link rel="prefetch" href="/assets/exceptionsHanding.html-21483fcb.js" as="script"><link rel="prefetch" href="/assets/freshness.html-dee51d40.js" as="script"><link rel="prefetch" href="/assets/functions.html-62641f59.js" as="script"><link rel="prefetch" href="/assets/generices.html-4d2ac27d.js" as="script"><link rel="prefetch" href="/assets/indexSignatures.html-43769f30.js" as="script"><link rel="prefetch" href="/assets/interfaces.html-10ff7e3b.js" as="script"><link rel="prefetch" href="/assets/lib.html-f244b2ca.js" as="script"><link rel="prefetch" href="/assets/literals.html-77a87e33.js" as="script"><link rel="prefetch" href="/assets/migrating.html-5f17a57d.js" as="script"><link rel="prefetch" href="/assets/mixins.html-2156d664.js" as="script"><link rel="prefetch" href="/assets/movingTypes.html-6777fb84.js" as="script"><link rel="prefetch" href="/assets/neverType.html-faf1f818.js" as="script"><link rel="prefetch" href="/assets/overview.html-4a5559c1.js" as="script"><link rel="prefetch" href="/assets/readonly.html-e1b8e5c9.js" as="script"><link rel="prefetch" href="/assets/thisType.html-9e8d8300.js" as="script"><link rel="prefetch" href="/assets/typeAssertion.html-098fc501.js" as="script"><link rel="prefetch" href="/assets/typeCompatibility.html-193f6c5d.js" as="script"><link rel="prefetch" href="/assets/typeGuard.html-0d21e5c7.js" as="script"><link rel="prefetch" href="/assets/typeInference.html-91ca5bf5.js" as="script"><link rel="prefetch" href="/assets/types.html-b38601de.js" as="script"><link rel="prefetch" href="/assets/CIE 1931 XYZ色彩空间详解.html-b79ea964.js" as="script"><link rel="prefetch" href="/assets/CIE 色度出版物（中英文）2018.html-268c6dc4.js" as="script"><link rel="prefetch" href="/assets/CIE.1931.COLOUR-MATCHING.FUNCTIONS.2.DEGREE.OBSERVE.html-f008f3de.js" as="script"><link rel="prefetch" href="/assets/CIE170-1(CIE2006a)颜色匹配函数计算模型.html-759c7276.js" as="script"><link rel="prefetch" href="/assets/根据功率频谱准确绘制 LED 颜色 - 文章资源.html-43572021.js" as="script"><link rel="prefetch" href="/assets/工具：函数图像工具.html-fc8045f6.js" as="script"><link rel="prefetch" href="/assets/案例大全.html-07b0a2a6.js" as="script"><link rel="prefetch" href="/assets/图标：vuepress-temp-hope.html-5e521365.js" as="script"><link rel="prefetch" href="/assets/课程介绍.html-65607166.js" as="script"><link rel="prefetch" href="/assets/html-css.html-d667f76a.js" as="script"><link rel="prefetch" href="/assets/javascript.html-6c536b3e.js" as="script"><link rel="prefetch" href="/assets/password.html-b5a70493.js" as="script"><link rel="prefetch" href="/assets/Base64.html-80d4029b.js" as="script"><link rel="prefetch" href="/assets/Color.html-9cb5306b.js" as="script"><link rel="prefetch" href="/assets/UUID.html-7727e2cf.js" as="script"><link rel="prefetch" href="/assets/audioAnalyser.html-7ae86e26.js" as="script"><link rel="prefetch" href="/assets/deep.clone.html-73bd5813.js" as="script"><link rel="prefetch" href="/assets/download.html-118f0090.js" as="script"><link rel="prefetch" href="/assets/format.html-bce01f07.js" as="script"><link rel="prefetch" href="/assets/iframe.html-e5f8b8c9.js" as="script"><link rel="prefetch" href="/assets/loadjs.html-be37afc9.js" as="script"><link rel="prefetch" href="/assets/parseToJson.html-06ab6bb4.js" as="script"><link rel="prefetch" href="/assets/getComputedStyle.html-1205c1d8.js" as="script"><link rel="prefetch" href="/assets/localeCompare.html-8552ed16.js" as="script"><link rel="prefetch" href="/assets/图像：2° coordinates from 2°  XYZ CMFs.html-6c3f97f0.js" as="script"><link rel="prefetch" href="/assets/图像：2°.CIE.1931.RGB系统光谱三刺激值曲线.html-72df77aa.js" as="script"><link rel="prefetch" href="/assets/图像：2°.CIE.1931.XYZ系统光谱三刺激值曲线.html-8eaa0a92.js" as="script"><link rel="prefetch" href="/assets/数据：2° 视场大小的视锥光能基础响应.html-f259b64c.js" as="script"><link rel="prefetch" href="/assets/数据：2° 视场大小的视锥化学能基础响应.html-214f8c7a.js" as="script"><link rel="prefetch" href="/assets/数据：2°.CIE.1931.XYZ系统光谱三刺激值.html-be18b05c.js" as="script"><link rel="prefetch" href="/assets/L1.什么是操作系统.html-3f27e50d.js" as="script"><link rel="prefetch" href="/assets/404.html-81de84fb.js" as="script"><link rel="prefetch" href="/assets/index.html-df04ee16.js" as="script"><link rel="prefetch" href="/assets/index.html-a2d9646c.js" as="script"><link rel="prefetch" href="/assets/index.html-2dd4e9a1.js" as="script"><link rel="prefetch" href="/assets/index.html-55868e76.js" as="script"><link rel="prefetch" href="/assets/index.html-11fda04a.js" as="script"><link rel="prefetch" href="/assets/index.html-b7ae1dda.js" as="script"><link rel="prefetch" href="/assets/index.html-adeaf5a0.js" as="script"><link rel="prefetch" href="/assets/index.html-85833432.js" as="script"><link rel="prefetch" href="/assets/index.html-954f0c3f.js" as="script"><link rel="prefetch" href="/assets/index.html-adbb2503.js" as="script"><link rel="prefetch" href="/assets/index.html-49797614.js" as="script"><link rel="prefetch" href="/assets/index.html-ca88f71e.js" as="script"><link rel="prefetch" href="/assets/index.html-a2c37c05.js" as="script"><link rel="prefetch" href="/assets/index.html-6ae31aff.js" as="script"><link rel="prefetch" href="/assets/index.html-3f512a29.js" as="script"><link rel="prefetch" href="/assets/index.html-7adacce5.js" as="script"><link rel="prefetch" href="/assets/index.html-73d95ed2.js" as="script"><link rel="prefetch" href="/assets/index.html-5817c93b.js" as="script"><link rel="prefetch" href="/assets/index.html-bb6daf91.js" as="script"><link rel="prefetch" href="/assets/index.html-2aef8cab.js" as="script"><link rel="prefetch" href="/assets/index.html-e918fb82.js" as="script"><link rel="prefetch" href="/assets/index.html-b3e4aa37.js" as="script"><link rel="prefetch" href="/assets/index.html-5d09d26d.js" as="script"><link rel="prefetch" href="/assets/index.html-065cf38d.js" as="script"><link rel="prefetch" href="/assets/index.html-a92f9841.js" as="script"><link rel="prefetch" href="/assets/index.html-68eca9e0.js" as="script"><link rel="prefetch" href="/assets/index.html-43bec9dc.js" as="script"><link rel="prefetch" href="/assets/index.html-bb9a5a0c.js" as="script"><link rel="prefetch" href="/assets/index.html-4dfa994a.js" as="script"><link rel="prefetch" href="/assets/index.html-6407f86c.js" as="script"><link rel="prefetch" href="/assets/index.html-82a0cf13.js" as="script"><link rel="prefetch" href="/assets/index.html-e7ea063e.js" as="script"><link rel="prefetch" href="/assets/index.html-4e4aecd2.js" as="script"><link rel="prefetch" href="/assets/index.html-a55ae107.js" as="script"><link rel="prefetch" href="/assets/index.html-6031e54c.js" as="script"><link rel="prefetch" href="/assets/index.html-130ce4bf.js" as="script"><link rel="prefetch" href="/assets/index.html-34b56a58.js" as="script"><link rel="prefetch" href="/assets/index.html-267d5a42.js" as="script"><link rel="prefetch" href="/assets/index.html-cac08cfd.js" as="script"><link rel="prefetch" href="/assets/index.html-ed6c5516.js" as="script"><link rel="prefetch" href="/assets/index.html-d5b84911.js" as="script"><link rel="prefetch" href="/assets/index.html-c6efa200.js" as="script"><link rel="prefetch" href="/assets/index.html-d0031563.js" as="script"><link rel="prefetch" href="/assets/index.html-d4f523f2.js" as="script"><link rel="prefetch" href="/assets/index.html-a908d03b.js" as="script"><link rel="prefetch" href="/assets/index.html-48aa1e73.js" as="script"><link rel="prefetch" href="/assets/index.html-1bb01f7e.js" as="script"><link rel="prefetch" href="/assets/index.html-7ca08b60.js" as="script"><link rel="prefetch" href="/assets/index.html-d22d293d.js" as="script"><link rel="prefetch" href="/assets/index.html-93b99ca3.js" as="script"><link rel="prefetch" href="/assets/index.html-133b554e.js" as="script"><link rel="prefetch" href="/assets/index.html-03d0d93a.js" as="script"><link rel="prefetch" href="/assets/index.html-5ffa48a2.js" as="script"><link rel="prefetch" href="/assets/index.html-42432e3b.js" as="script"><link rel="prefetch" href="/assets/index.html-08055731.js" as="script"><link rel="prefetch" href="/assets/index.html-d35e4e45.js" as="script"><link rel="prefetch" href="/assets/index.html-1deae25f.js" as="script"><link rel="prefetch" href="/assets/index.html-69b65684.js" as="script"><link rel="prefetch" href="/assets/index.html-c8a5c4f7.js" as="script"><link rel="prefetch" href="/assets/index.html-d91558f5.js" as="script"><link rel="prefetch" href="/assets/index.html-a238749b.js" as="script"><link rel="prefetch" href="/assets/index.html-339e0ba8.js" as="script"><link rel="prefetch" href="/assets/index.html-e619fb96.js" as="script"><link rel="prefetch" href="/assets/index.html-ada432f6.js" as="script"><link rel="prefetch" href="/assets/index.html-ed832418.js" as="script"><link rel="prefetch" href="/assets/index.html-dbb371c6.js" as="script"><link rel="prefetch" href="/assets/index.html-9e13a72d.js" as="script"><link rel="prefetch" href="/assets/index.html-739d2392.js" as="script"><link rel="prefetch" href="/assets/index.html-d12a8922.js" as="script"><link rel="prefetch" href="/assets/index.html-691b705d.js" as="script"><link rel="prefetch" href="/assets/index.html-eb05b6d4.js" as="script"><link rel="prefetch" href="/assets/index.html-81123c1b.js" as="script"><link rel="prefetch" href="/assets/index.html-c997cc01.js" as="script"><link rel="prefetch" href="/assets/index.html-f4b73d65.js" as="script"><link rel="prefetch" href="/assets/index.html-8d232b42.js" as="script"><link rel="prefetch" href="/assets/index.html-075fc650.js" as="script"><link rel="prefetch" href="/assets/index.html-40948553.js" as="script"><link rel="prefetch" href="/assets/intro.html-a1901505.js" as="script"><link rel="prefetch" href="/assets/slides.html-59032a65.js" as="script"><link rel="prefetch" href="/assets/slidesOld.html-86de0da8.js" as="script"><link rel="prefetch" href="/assets/index.html-7c6f1102.js" as="script"><link rel="prefetch" href="/assets/mg.html-abbc8572.js" as="script"><link rel="prefetch" href="/assets/mg.html-29434a6f.js" as="script"><link rel="prefetch" href="/assets/index.html-48031c85.js" as="script"><link rel="prefetch" href="/assets/中华田园文化.html-068e28e7.js" as="script"><link rel="prefetch" href="/assets/NormalDay.html-b4e009e3.js" as="script"><link rel="prefetch" href="/assets/index.html-6ec54a2c.js" as="script"><link rel="prefetch" href="/assets/争与不争.html-190639e9.js" as="script"><link rel="prefetch" href="/assets/和气生财.html-bcbef8e6.js" as="script"><link rel="prefetch" href="/assets/闷声发大财.html-4030dc41.js" as="script"><link rel="prefetch" href="/assets/index.html-51f60a44.js" as="script"><link rel="prefetch" href="/assets/github.html-0ebd6333.js" as="script"><link rel="prefetch" href="/assets/高速摄像头资源.html-82f9107f.js" as="script"><link rel="prefetch" href="/assets/浏览器收藏夹-脚本.html-0db6b189.js" as="script"><link rel="prefetch" href="/assets/course.html-1fdd61cb.js" as="script"><link rel="prefetch" href="/assets/index.html-49be9c56.js" as="script"><link rel="prefetch" href="/assets/me.html-3b8e6ef6.js" as="script"><link rel="prefetch" href="/assets/index.html-4648d288.js" as="script"><link rel="prefetch" href="/assets/index.html-9829bc5b.js" as="script"><link rel="prefetch" href="/assets/基础知识：配色原理.html-0f148c78.js" as="script"><link rel="prefetch" href="/assets/背景知识：色学发展时间表.html-c24dd242.js" as="script"><link rel="prefetch" href="/assets/课程知识：颜色科学.html-5dc109af.js" as="script"><link rel="prefetch" href="/assets/Setting.html-48fc6cb9.js" as="script"><link rel="prefetch" href="/assets/Snippets.html-5b7e4891.js" as="script"><link rel="prefetch" href="/assets/程序员常用英语词汇.html-d7e9ed5c.js" as="script"><link rel="prefetch" href="/assets/计算机编程及常用术语英语词汇大全.html-bccc1fa4.js" as="script"><link rel="prefetch" href="/assets/1114路由器默认密码.html-1938cb9b.js" as="script"><link rel="prefetch" href="/assets/dism安装脚本.html-b0f71306.js" as="script"><link rel="prefetch" href="/assets/ChromeExtension.html-2f083315.js" as="script"><link rel="prefetch" href="/assets/Git with SSH.html-84fd6acf.js" as="script"><link rel="prefetch" href="/assets/AI工具.html-7accba64.js" as="script"><link rel="prefetch" href="/assets/时空葫芦工具箱.html-3b227705.js" as="script"><link rel="prefetch" href="/assets/音乐番茄果果果.html-6148e2fa.js" as="script"><link rel="prefetch" href="/assets/《周公解梦》.html-366651bd.js" as="script"><link rel="prefetch" href="/assets/《敦煌本梦书》.html-95697286.js" as="script"><link rel="prefetch" href="/assets/《断梦秘书》.html-68548940.js" as="script"><link rel="prefetch" href="/assets/《入药镜》.html-287888b5.js" as="script"><link rel="prefetch" href="/assets/index.html-94eee020.js" as="script"><link rel="prefetch" href="/assets/一般广告违禁词.html-6407d8f0.js" as="script"><link rel="prefetch" href="/assets/中华人民共和国广告法.html-2188a79d.js" as="script"><link rel="prefetch" href="/assets/互联网广告管理办法.html-aa5dd057.js" as="script"><link rel="prefetch" href="/assets/index.html-34c5d9e1.js" as="script"><link rel="prefetch" href="/assets/中华人民共和国著作权法（2020）.html-cbd07301.js" as="script"><link rel="prefetch" href="/assets/中国版权保护中心著作权自愿登记收费标准.html-63d53c00.js" as="script"><link rel="prefetch" href="/assets/index.html-b1ae3946.js" as="script"><link rel="prefetch" href="/assets/disrupt.html-725f8cf2.js" as="script"><link rel="prefetch" href="/assets/lane.html-aa1da54d.js" as="script"><link rel="prefetch" href="/assets/prepare.html-3e5e488a.js" as="script"><link rel="prefetch" href="/assets/scheduler.html-fb89f887.js" as="script"><link rel="prefetch" href="/assets/multi.html-794d9157.js" as="script"><link rel="prefetch" href="/assets/one.html-f7b4f18f.js" as="script"><link rel="prefetch" href="/assets/prepare.html-ab2f8c56.js" as="script"><link rel="prefetch" href="/assets/create.html-5364654e.js" as="script"><link rel="prefetch" href="/assets/prepare.html-4aab6d6a.js" as="script"><link rel="prefetch" href="/assets/structure.html-7494e754.js" as="script"><link rel="prefetch" href="/assets/useeffect.html-b60a9df8.js" as="script"><link rel="prefetch" href="/assets/usememo.html-80e7cbbc.js" as="script"><link rel="prefetch" href="/assets/useref.html-2f0dd70a.js" as="script"><link rel="prefetch" href="/assets/usestate.html-f771e7b0.js" as="script"><link rel="prefetch" href="/assets/file.html-effa6e1c.js" as="script"><link rel="prefetch" href="/assets/idea.html-c73dc687.js" as="script"><link rel="prefetch" href="/assets/jsx.html-8695d734.js" as="script"><link rel="prefetch" href="/assets/newConstructure.html-f4b971d2.js" as="script"><link rel="prefetch" href="/assets/oldConstructure.html-b8c4efee.js" as="script"><link rel="prefetch" href="/assets/source.html-d456bd09.js" as="script"><link rel="prefetch" href="/assets/summary.html-35720017.js" as="script"><link rel="prefetch" href="/assets/beginWork.html-10e0102d.js" as="script"><link rel="prefetch" href="/assets/completeWork.html-f2290b4b.js" as="script"><link rel="prefetch" href="/assets/doubleBuffer.html-f6a46a2b.js" as="script"><link rel="prefetch" href="/assets/fiber-mental.html-3873a5a7.js" as="script"><link rel="prefetch" href="/assets/fiber.html-d844e87c.js" as="script"><link rel="prefetch" href="/assets/reconciler.html-1a186ab8.js" as="script"><link rel="prefetch" href="/assets/beforeMutation.html-10c0b563.js" as="script"><link rel="prefetch" href="/assets/layout.html-3683c363.js" as="script"><link rel="prefetch" href="/assets/mutation.html-2ec385e7.js" as="script"><link rel="prefetch" href="/assets/prepare.html-655ba0be.js" as="script"><link rel="prefetch" href="/assets/mental.html-4d5723df.js" as="script"><link rel="prefetch" href="/assets/prepare.html-dc12b884.js" as="script"><link rel="prefetch" href="/assets/priority.html-8d840c0d.js" as="script"><link rel="prefetch" href="/assets/reactdom.html-cc10fbbe.js" as="script"><link rel="prefetch" href="/assets/setstate.html-3dadcc0b.js" as="script"><link rel="prefetch" href="/assets/update.html-e4dedfc4.js" as="script"><link rel="prefetch" href="/assets/codegen.html-2c62147c.js" as="script"><link rel="prefetch" href="/assets/entrance.html-663b3b41.js" as="script"><link rel="prefetch" href="/assets/index.html-3fa09136.js" as="script"><link rel="prefetch" href="/assets/optimize.html-3a323512.js" as="script"><link rel="prefetch" href="/assets/parse.html-00dff523.js" as="script"><link rel="prefetch" href="/assets/async-component.html-0fe922a1.js" as="script"><link rel="prefetch" href="/assets/component-register.html-e943ddd9.js" as="script"><link rel="prefetch" href="/assets/create-component.html-ebaec33d.js" as="script"><link rel="prefetch" href="/assets/index.html-4fcb4041.js" as="script"><link rel="prefetch" href="/assets/lifecycle.html-3a516eef.js" as="script"><link rel="prefetch" href="/assets/merge-option.html-f1ea4abe.js" as="script"><link rel="prefetch" href="/assets/patch.html-50a8a837.js" as="script"><link rel="prefetch" href="/assets/create-element.html-13d715b0.js" as="script"><link rel="prefetch" href="/assets/index.html-3090092a.js" as="script"><link rel="prefetch" href="/assets/mounted.html-4c86d08b.js" as="script"><link rel="prefetch" href="/assets/new-vue.html-0608b504.js" as="script"><link rel="prefetch" href="/assets/render.html-c60c947c.js" as="script"><link rel="prefetch" href="/assets/update.html-549101b2.js" as="script"><link rel="prefetch" href="/assets/virtual-dom.html-a29bc520.js" as="script"><link rel="prefetch" href="/assets/event.html-60223e95.js" as="script"><link rel="prefetch" href="/assets/index.html-5a639663.js" as="script"><link rel="prefetch" href="/assets/keep-alive.html-92e56f1d.js" as="script"><link rel="prefetch" href="/assets/slot.html-7145aa73.js" as="script"><link rel="prefetch" href="/assets/tansition-group.html-b909da90.js" as="script"><link rel="prefetch" href="/assets/tansition.html-ba9660dc.js" as="script"><link rel="prefetch" href="/assets/v-model.html-0afdfd3f.js" as="script"><link rel="prefetch" href="/assets/build.html-32b6320f.js" as="script"><link rel="prefetch" href="/assets/directory.html-4f78f828.js" as="script"><link rel="prefetch" href="/assets/entrance.html-554ccfd8.js" as="script"><link rel="prefetch" href="/assets/flow.html-0418aa77.js" as="script"><link rel="prefetch" href="/assets/index.html-2eeed8a4.js" as="script"><link rel="prefetch" href="/assets/component-update.html-0f6c7278.js" as="script"><link rel="prefetch" href="/assets/computed-watcher.html-8e8377e0.js" as="script"><link rel="prefetch" href="/assets/getters.html-5d5f942c.js" as="script"><link rel="prefetch" href="/assets/index.html-8c3a1d06.js" as="script"><link rel="prefetch" href="/assets/next-tick.html-d78db5b3.js" as="script"><link rel="prefetch" href="/assets/questions.html-63490d9f.js" as="script"><link rel="prefetch" href="/assets/reactive-object.html-c8db4810.js" as="script"><link rel="prefetch" href="/assets/setters.html-1e0fb74c.js" as="script"><link rel="prefetch" href="/assets/summary.html-385ec33f.js" as="script"><link rel="prefetch" href="/assets/index.html-c72d9c20.js" as="script"><link rel="prefetch" href="/assets/install.html-2ce86199.js" as="script"><link rel="prefetch" href="/assets/matcher.html-eb2f6ab6.js" as="script"><link rel="prefetch" href="/assets/router.html-0a8c00ca.js" as="script"><link rel="prefetch" href="/assets/transition-to.html-9b555286.js" as="script"><link rel="prefetch" href="/assets/api.html-c6649d53.js" as="script"><link rel="prefetch" href="/assets/index.html-8dac2ec5.js" as="script"><link rel="prefetch" href="/assets/init.html-6eaa92cf.js" as="script"><link rel="prefetch" href="/assets/plugin.html-e15260e2.js" as="script"><link rel="prefetch" href="/assets/ast.html-84a4ea03.js" as="script"><link rel="prefetch" href="/assets/binder.html-924376db.js" as="script"><link rel="prefetch" href="/assets/checker.html-dd610814.js" as="script"><link rel="prefetch" href="/assets/emitter.html-2cdb8afa.js" as="script"><link rel="prefetch" href="/assets/overview.html-2abe7efb.js" as="script"><link rel="prefetch" href="/assets/parser.html-f3e43a99.js" as="script"><link rel="prefetch" href="/assets/program.html-b43cf227.js" as="script"><link rel="prefetch" href="/assets/scanner.html-77ac399b.js" as="script"><link rel="prefetch" href="/assets/common.html-8f558a02.js" as="script"><link rel="prefetch" href="/assets/interpreting.html-f4010327.js" as="script"><link rel="prefetch" href="/assets/class.html-067e7f4f.js" as="script"><link rel="prefetch" href="/assets/commandline-behavior.html-52b6a992.js" as="script"><link rel="prefetch" href="/assets/comments.html-9ce440c0.js" as="script"><link rel="prefetch" href="/assets/common-bug-not-bugs.html-89809438.js" as="script"><link rel="prefetch" href="/assets/common-feature-request.html-78b251b8.js" as="script"><link rel="prefetch" href="/assets/decorators.html-cd743ae0.js" as="script"><link rel="prefetch" href="/assets/enums.html-3571aa1b.js" as="script"><link rel="prefetch" href="/assets/function.html-3f67d1b2.js" as="script"><link rel="prefetch" href="/assets/generics.html-175c06cc.js" as="script"><link rel="prefetch" href="/assets/glossary-and-terms.html-8e65a586.js" as="script"><link rel="prefetch" href="/assets/jsx-and-react.html-0ab4d559.js" as="script"><link rel="prefetch" href="/assets/modules.html-88cc5b9c.js" as="script"><link rel="prefetch" href="/assets/thing-that-dont-work.html-430c46be.js" as="script"><link rel="prefetch" href="/assets/tsconfig-behavior.html-0e02b83e.js" as="script"><link rel="prefetch" href="/assets/type-guards.html-0b611128.js" as="script"><link rel="prefetch" href="/assets/type-system-behavior.html-cbcd8951.js" as="script"><link rel="prefetch" href="/assets/nonReactJSX.html-90132612.js" as="script"><link rel="prefetch" href="/assets/reactJSX.html-ed360d81.js" as="script"><link rel="prefetch" href="/assets/support.html-9179a417.js" as="script"><link rel="prefetch" href="/assets/typescript-3.7.html-fa0266a1.js" as="script"><link rel="prefetch" href="/assets/typescript-3.8.html-8e561abd.js" as="script"><link rel="prefetch" href="/assets/typescript-3.9.html-9d2cca1c.js" as="script"><link rel="prefetch" href="/assets/compilationContext.html-0e5aa55c.js" as="script"><link rel="prefetch" href="/assets/declarationspaces.html-aa3e03ff.js" as="script"><link rel="prefetch" href="/assets/dynamicImportExpressions.html-1f8d5e21.js" as="script"><link rel="prefetch" href="/assets/modules.html-9a082641.js" as="script"><link rel="prefetch" href="/assets/namespaces.html-c976b166.js" as="script"><link rel="prefetch" href="/assets/avoidExportDefault.html-f615ac35.js" as="script"><link rel="prefetch" href="/assets/barrel.html-e8e3bc86.js" as="script"><link rel="prefetch" href="/assets/bind.html-41eca47a.js" as="script"><link rel="prefetch" href="/assets/buildToggles.html-0170f7de.js" as="script"><link rel="prefetch" href="/assets/classAreUseful.html-7334e360.js" as="script"><link rel="prefetch" href="/assets/covarianceAndContravariance.html-f4492f4b.js" as="script"><link rel="prefetch" href="/assets/createArrays.html-1879df14.js" as="script"><link rel="prefetch" href="/assets/curry.html-b9d33ab7.js" as="script"><link rel="prefetch" href="/assets/functionParameters.html-baf0958e.js" as="script"><link rel="prefetch" href="/assets/infer.html-298c002c.js" as="script"><link rel="prefetch" href="/assets/lazyObjectLiteralInitialization.html-f80d9bba.js" as="script"><link rel="prefetch" href="/assets/limitPropertySetters.html-77af92eb.js" as="script"><link rel="prefetch" href="/assets/metadata.html-acdf7570.js" as="script"><link rel="prefetch" href="/assets/nominalTyping.html-e3b2ee2e.js" as="script"><link rel="prefetch" href="/assets/outFileCaution.html-674274cf.js" as="script"><link rel="prefetch" href="/assets/singletonPatern.html-5fcdd5b6.js" as="script"><link rel="prefetch" href="/assets/statefulFunctions.html-ed1cd36f.js" as="script"><link rel="prefetch" href="/assets/staticConstructors.html-1647806e.js" as="script"><link rel="prefetch" href="/assets/stringBasedEmuns.html-13b90dd6.js" as="script"><link rel="prefetch" href="/assets/truthy.html-051fdcd2.js" as="script"><link rel="prefetch" href="/assets/typeInstantiation.html-fb88ad76.js" as="script"><link rel="prefetch" href="/assets/typesafeEventEmitter.html-97a56334.js" as="script"><link rel="prefetch" href="/assets/ambient.html-0a0ea25d.js" as="script"><link rel="prefetch" href="/assets/callable.html-bb96f78f.js" as="script"><link rel="prefetch" href="/assets/discrominatedUnion.html-12c304fe.js" as="script"><link rel="prefetch" href="/assets/enums.html-9cfc6774.js" as="script"><link rel="prefetch" href="/assets/exceptionsHanding.html-2c0c8e05.js" as="script"><link rel="prefetch" href="/assets/freshness.html-d5a066ac.js" as="script"><link rel="prefetch" href="/assets/functions.html-488baba2.js" as="script"><link rel="prefetch" href="/assets/generices.html-977e80d5.js" as="script"><link rel="prefetch" href="/assets/indexSignatures.html-14e17d21.js" as="script"><link rel="prefetch" href="/assets/interfaces.html-4b2beb8c.js" as="script"><link rel="prefetch" href="/assets/lib.html-122306ae.js" as="script"><link rel="prefetch" href="/assets/literals.html-65a05970.js" as="script"><link rel="prefetch" href="/assets/migrating.html-695f6707.js" as="script"><link rel="prefetch" href="/assets/mixins.html-6b19d599.js" as="script"><link rel="prefetch" href="/assets/movingTypes.html-6bd3519d.js" as="script"><link rel="prefetch" href="/assets/neverType.html-9431cb0a.js" as="script"><link rel="prefetch" href="/assets/overview.html-cd358063.js" as="script"><link rel="prefetch" href="/assets/readonly.html-83c1540b.js" as="script"><link rel="prefetch" href="/assets/thisType.html-9d5fe169.js" as="script"><link rel="prefetch" href="/assets/typeAssertion.html-31d125eb.js" as="script"><link rel="prefetch" href="/assets/typeCompatibility.html-42bfa172.js" as="script"><link rel="prefetch" href="/assets/typeGuard.html-f8e7801d.js" as="script"><link rel="prefetch" href="/assets/typeInference.html-37709765.js" as="script"><link rel="prefetch" href="/assets/types.html-c0417ae3.js" as="script"><link rel="prefetch" href="/assets/CIE 1931 XYZ色彩空间详解.html-c7346760.js" as="script"><link rel="prefetch" href="/assets/CIE 色度出版物（中英文）2018.html-553acb35.js" as="script"><link rel="prefetch" href="/assets/CIE.1931.COLOUR-MATCHING.FUNCTIONS.2.DEGREE.OBSERVE.html-d471527d.js" as="script"><link rel="prefetch" href="/assets/CIE170-1(CIE2006a)颜色匹配函数计算模型.html-4c04d161.js" as="script"><link rel="prefetch" href="/assets/根据功率频谱准确绘制 LED 颜色 - 文章资源.html-1b974917.js" as="script"><link rel="prefetch" href="/assets/工具：函数图像工具.html-33b87efe.js" as="script"><link rel="prefetch" href="/assets/案例大全.html-bbb64ad6.js" as="script"><link rel="prefetch" href="/assets/图标：vuepress-temp-hope.html-d00a9f04.js" as="script"><link rel="prefetch" href="/assets/课程介绍.html-0288bed6.js" as="script"><link rel="prefetch" href="/assets/html-css.html-2d3172cc.js" as="script"><link rel="prefetch" href="/assets/javascript.html-b7398716.js" as="script"><link rel="prefetch" href="/assets/password.html-a278bc2a.js" as="script"><link rel="prefetch" href="/assets/Base64.html-f6d7cf49.js" as="script"><link rel="prefetch" href="/assets/Color.html-2d1ab050.js" as="script"><link rel="prefetch" href="/assets/UUID.html-1c49e5bf.js" as="script"><link rel="prefetch" href="/assets/audioAnalyser.html-5bf14c28.js" as="script"><link rel="prefetch" href="/assets/deep.clone.html-80b45cfe.js" as="script"><link rel="prefetch" href="/assets/download.html-ceda753e.js" as="script"><link rel="prefetch" href="/assets/format.html-0d18f38c.js" as="script"><link rel="prefetch" href="/assets/iframe.html-f4254577.js" as="script"><link rel="prefetch" href="/assets/loadjs.html-40d0fbd9.js" as="script"><link rel="prefetch" href="/assets/parseToJson.html-8f343665.js" as="script"><link rel="prefetch" href="/assets/getComputedStyle.html-1a5d6b1d.js" as="script"><link rel="prefetch" href="/assets/localeCompare.html-6771d5ad.js" as="script"><link rel="prefetch" href="/assets/图像：2° coordinates from 2°  XYZ CMFs.html-8a1914e9.js" as="script"><link rel="prefetch" href="/assets/图像：2°.CIE.1931.RGB系统光谱三刺激值曲线.html-9615d4cd.js" as="script"><link rel="prefetch" href="/assets/图像：2°.CIE.1931.XYZ系统光谱三刺激值曲线.html-9e79d3fd.js" as="script"><link rel="prefetch" href="/assets/数据：2° 视场大小的视锥光能基础响应.html-a92334ea.js" as="script"><link rel="prefetch" href="/assets/数据：2° 视场大小的视锥化学能基础响应.html-c83ff530.js" as="script"><link rel="prefetch" href="/assets/数据：2°.CIE.1931.XYZ系统光谱三刺激值.html-1df00ff9.js" as="script"><link rel="prefetch" href="/assets/L1.什么是操作系统.html-bf5b184e.js" as="script"><link rel="prefetch" href="/assets/404.html-9f7a3bbd.js" as="script"><link rel="prefetch" href="/assets/index.html-8a8ff562.js" as="script"><link rel="prefetch" href="/assets/index.html-e6476df7.js" as="script"><link rel="prefetch" href="/assets/index.html-2bed6ee1.js" as="script"><link rel="prefetch" href="/assets/index.html-08f05241.js" as="script"><link rel="prefetch" href="/assets/index.html-9247120b.js" as="script"><link rel="prefetch" href="/assets/index.html-cf88d270.js" as="script"><link rel="prefetch" href="/assets/index.html-a2833308.js" as="script"><link rel="prefetch" href="/assets/index.html-a13c164c.js" as="script"><link rel="prefetch" href="/assets/index.html-0367ecde.js" as="script"><link rel="prefetch" href="/assets/index.html-ac63dc9f.js" as="script"><link rel="prefetch" href="/assets/index.html-2358fd32.js" as="script"><link rel="prefetch" href="/assets/index.html-dccd8f0f.js" as="script"><link rel="prefetch" href="/assets/index.html-f9b2460f.js" as="script"><link rel="prefetch" href="/assets/index.html-47108c45.js" as="script"><link rel="prefetch" href="/assets/index.html-393e8ef9.js" as="script"><link rel="prefetch" href="/assets/index.html-94be720f.js" as="script"><link rel="prefetch" href="/assets/index.html-1f15b3b9.js" as="script"><link rel="prefetch" href="/assets/index.html-77cf79bb.js" as="script"><link rel="prefetch" href="/assets/index.html-b12a454b.js" as="script"><link rel="prefetch" href="/assets/index.html-50d3f296.js" as="script"><link rel="prefetch" href="/assets/index.html-6d31ddf6.js" as="script"><link rel="prefetch" href="/assets/index.html-3b1cad37.js" as="script"><link rel="prefetch" href="/assets/index.html-dee0fb6b.js" as="script"><link rel="prefetch" href="/assets/index.html-3b7819b3.js" as="script"><link rel="prefetch" href="/assets/index.html-151e449e.js" as="script"><link rel="prefetch" href="/assets/index.html-af63752d.js" as="script"><link rel="prefetch" href="/assets/index.html-a2ba50e9.js" as="script"><link rel="prefetch" href="/assets/index.html-06b65b0d.js" as="script"><link rel="prefetch" href="/assets/index.html-64348cf8.js" as="script"><link rel="prefetch" href="/assets/index.html-5b450b12.js" as="script"><link rel="prefetch" href="/assets/index.html-0d5c82c0.js" as="script"><link rel="prefetch" href="/assets/index.html-22400f70.js" as="script"><link rel="prefetch" href="/assets/index.html-35e4a13b.js" as="script"><link rel="prefetch" href="/assets/index.html-2c4821ee.js" as="script"><link rel="prefetch" href="/assets/index.html-d13beacc.js" as="script"><link rel="prefetch" href="/assets/index.html-3d193b87.js" as="script"><link rel="prefetch" href="/assets/index.html-bf939b93.js" as="script"><link rel="prefetch" href="/assets/index.html-555754ab.js" as="script"><link rel="prefetch" href="/assets/index.html-1922d8b1.js" as="script"><link rel="prefetch" href="/assets/index.html-c057231f.js" as="script"><link rel="prefetch" href="/assets/index.html-3bc8fe50.js" as="script"><link rel="prefetch" href="/assets/index.html-d20ae458.js" as="script"><link rel="prefetch" href="/assets/index.html-2e4e2240.js" as="script"><link rel="prefetch" href="/assets/index.html-af84651a.js" as="script"><link rel="prefetch" href="/assets/index.html-4cc9ead9.js" as="script"><link rel="prefetch" href="/assets/index.html-16bdcc27.js" as="script"><link rel="prefetch" href="/assets/index.html-58ba55dd.js" as="script"><link rel="prefetch" href="/assets/index.html-99197cf7.js" as="script"><link rel="prefetch" href="/assets/index.html-4c707bd0.js" as="script"><link rel="prefetch" href="/assets/index.html-e04dbee2.js" as="script"><link rel="prefetch" href="/assets/index.html-a596449e.js" as="script"><link rel="prefetch" href="/assets/index.html-452226b3.js" as="script"><link rel="prefetch" href="/assets/index.html-98301bc9.js" as="script"><link rel="prefetch" href="/assets/index.html-55b00cdf.js" as="script"><link rel="prefetch" href="/assets/index.html-6fcb6951.js" as="script"><link rel="prefetch" href="/assets/index.html-20d9dbc2.js" as="script"><link rel="prefetch" href="/assets/index.html-11311f89.js" as="script"><link rel="prefetch" href="/assets/index.html-3ed3b661.js" as="script"><link rel="prefetch" href="/assets/index.html-487db8f4.js" as="script"><link rel="prefetch" href="/assets/index.html-479c466b.js" as="script"><link rel="prefetch" href="/assets/index.html-2527308d.js" as="script"><link rel="prefetch" href="/assets/index.html-1b45c64e.js" as="script"><link rel="prefetch" href="/assets/index.html-690a004c.js" as="script"><link rel="prefetch" href="/assets/index.html-3475b855.js" as="script"><link rel="prefetch" href="/assets/index.html-2a95b0e6.js" as="script"><link rel="prefetch" href="/assets/index.html-666b31ce.js" as="script"><link rel="prefetch" href="/assets/index.html-571d22fa.js" as="script"><link rel="prefetch" href="/assets/index.html-41ff7667.js" as="script"><link rel="prefetch" href="/assets/index.html-e834ad94.js" as="script"><link rel="prefetch" href="/assets/index.html-135ee1f0.js" as="script"><link rel="prefetch" href="/assets/index.html-404e8806.js" as="script"><link rel="prefetch" href="/assets/index.html-1b3cdee2.js" as="script"><link rel="prefetch" href="/assets/index.html-cfc22104.js" as="script"><link rel="prefetch" href="/assets/index.html-cd93bbd6.js" as="script"><link rel="prefetch" href="/assets/index.html-e74a45c9.js" as="script"><link rel="prefetch" href="/assets/index.html-40a6dae1.js" as="script"><link rel="prefetch" href="/assets/auto-ba5ecab5.js" as="script"><link rel="prefetch" href="/assets/index-b03bef79.js" as="script"><link rel="prefetch" href="/assets/flowchart-8b576787.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-6eaa7749.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-75b11b9d.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-0191f9da.js" as="script"><link rel="prefetch" href="/assets/math.esm-70a288c8.js" as="script"><link rel="prefetch" href="/assets/notes.esm-a106bb2c.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-ab04f0b1.js" as="script"><link rel="prefetch" href="/assets/search.esm-7e6792e2.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-b83b91d0.js" as="script"><link rel="prefetch" href="/assets/VuePlayground-4b43e19b.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-36cd6c3c.js" as="script"><link rel="prefetch" href="/assets/SearchResult-09785797.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">跳至主要內容</a><!--]--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button type="button" class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a href="/" class="brand"><img class="logo" src="/assets/avatar/cat.webp" alt="魔法Bug"><!----><span class="site-name hide-in-pad">魔法Bug</span></a><!--]--><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!--[--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="font-icon icon iconfont icon-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/views/Posts/" class="nav-link" aria-label="博文"><span class="font-icon icon iconfont icon-hot" style=""></span>博文<!----></a></div><div class="nav-item hide-in-mobile"><a href="/views/DevLog/" class="nav-link" aria-label="开发日志"><span class="font-icon icon iconfont icon-IO" style=""></span>开发日志<!----></a></div><div class="nav-item hide-in-mobile"><a href="/views/Share/" class="nav-link" aria-label="数字宝库"><span class="font-icon icon iconfont icon-launch" style=""></span>数字宝库<!----></a></div><div class="nav-item hide-in-mobile"><a href="/views/Books/" class="nav-link active" aria-label="藏书阁"><span class="font-icon icon iconfont icon-repo" style=""></span>藏书阁<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item"><a class="repo-link" href="https://gitee.com/mpbug/mpbug" target="_blank" rel="noopener noreferrer" aria-label="Gitee"><svg xmlns="http://www.w3.org/2000/svg" class="icon gitee-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="gitee icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm242.97-533.34H482.39a23.7 23.7 0 0 0-23.7 23.7l-.03 59.28c0 13.08 10.59 23.7 23.7 23.7h165.96a23.7 23.7 0 0 1 23.7 23.7v11.85a71.1 71.1 0 0 1-71.1 71.1H375.71a23.7 23.7 0 0 1-23.7-23.7V423.11a71.1 71.1 0 0 1 71.1-71.1h331.8a23.7 23.7 0 0 0 23.7-23.7l.06-59.25a23.73 23.73 0 0 0-23.7-23.73H423.11a177.78 177.78 0 0 0-177.78 177.75v331.83c0 13.08 10.62 23.7 23.7 23.7h349.62a159.99 159.99 0 0 0 159.99-159.99V482.33a23.7 23.7 0 0 0-23.7-23.7z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" role="search" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="placeholder">搜索</div><div class="key-hints"><kbd class="key">Ctrl</kbd><kbd class="key">K</kbd></div></button><!--]--><!--]--><!--[--><!----><!--]--><button type="button" class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-folder" style=""></span><a href="/views/Books/Front-end/" class="nav-link active title" aria-label="前端秘密"><!---->前端秘密<!----></a><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-repo" style=""></span><a href="/views/Books/Front-end/JustReact/" class="nav-link title" aria-label="《React 技术揭秘》"><!---->《React 技术揭秘》<!----></a><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><span class="font-icon icon iconfont icon-repo" style=""></span><a href="/views/Books/Front-end/JustVue2/" class="nav-link active title" aria-label="《Vue2 技术揭秘》"><!---->《Vue2 技术揭秘》<!----></a><span class="arrow down"></span></button><ul class="sidebar-links"><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">准备工作</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">数据驱动</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">组件化</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable active" type="button"><!----><span class="title">深入响应式原理</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/views/Books/Front-end/JustVue2/reactive/" class="nav-link sidebar-link sidebar-page" aria-label="Introduction"><!---->Introduction<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/views/Books/Front-end/JustVue2/reactive/reactive-object.html" class="nav-link sidebar-link sidebar-page" aria-label="响应式对象"><!---->响应式对象<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/views/Books/Front-end/JustVue2/reactive/getters.html" class="nav-link sidebar-link sidebar-page" aria-label="依赖收集"><!---->依赖收集<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/views/Books/Front-end/JustVue2/reactive/setters.html" class="nav-link sidebar-link sidebar-page" aria-label="派发更新"><!---->派发更新<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/views/Books/Front-end/JustVue2/reactive/next-tick.html" class="nav-link sidebar-link sidebar-page" aria-label="nextTick"><!---->nextTick<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/views/Books/Front-end/JustVue2/reactive/questions.html" class="nav-link sidebar-link sidebar-page" aria-label="检测变化的注意事项"><!---->检测变化的注意事项<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/views/Books/Front-end/JustVue2/reactive/computed-watcher.html" class="nav-link sidebar-link sidebar-page" aria-label="计算属性 VS 侦听属性"><!---->计算属性 VS 侦听属性<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/views/Books/Front-end/JustVue2/reactive/component-update.html" class="nav-link sidebar-link sidebar-page" aria-label="组件更新"><!---->组件更新<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Props (v2.6.11)"><!---->Props (v2.6.11)<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#规范化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="规范化"><!---->规范化<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#初始化" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="初始化"><!---->初始化<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#校验" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="校验"><!---->校验<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#响应式" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="响应式"><!---->响应式<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#代理" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="代理"><!---->代理<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#props-更新" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="Props 更新"><!---->Props 更新<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#子组件-props-更新" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="子组件 props 更新"><!---->子组件 props 更新<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#子组件重新渲染" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="子组件重新渲染"><!---->子组件重新渲染<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#toggleobserving" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="toggleObserving"><!---->toggleObserving<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#总结" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="总结"><!---->总结<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/views/Books/Front-end/JustVue2/reactive/summary.html" class="nav-link sidebar-link sidebar-page" aria-label="原理图"><!---->原理图<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">编译</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">扩展</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Vue Router</span><span class="arrow end"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><!----><span class="title">Vuex</span><span class="arrow end"></span></button><!----></section></li></ul></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable" type="button"><span class="font-icon icon iconfont icon-repo" style=""></span><a href="/views/Books/Front-end/TypescriptMaster/" class="nav-link title" aria-label="《TypeScript Deep Dive》"><!---->《TypeScript Deep Dive》<!----></a><span class="arrow end"></span></button><!----></section></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Props (v2.6.11)</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://mpbug.gitee.io/player/" target="_blank" rel="noopener noreferrer">魔法时空宝库</a></span><span property="author" content="魔法时空宝库"></span></span><!----><!----><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 16 分钟</span><meta property="timeRequired" content="PT16M"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#规范化" class="router-link-active router-link-exact-active toc-link level2">规范化</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#初始化" class="router-link-active router-link-exact-active toc-link level2">初始化</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#校验" class="router-link-active router-link-exact-active toc-link level3">校验</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#响应式" class="router-link-active router-link-exact-active toc-link level3">响应式</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#代理" class="router-link-active router-link-exact-active toc-link level3">代理</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#props-更新" class="router-link-active router-link-exact-active toc-link level2">Props 更新</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#子组件-props-更新" class="router-link-active router-link-exact-active toc-link level3">子组件 props 更新</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#子组件重新渲染" class="router-link-active router-link-exact-active toc-link level3">子组件重新渲染</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#toggleobserving" class="router-link-active router-link-exact-active toc-link level2">toggleObserving</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/views/Books/Front-end/JustVue2/reactive/props.html#总结" class="router-link-active router-link-exact-active toc-link level2">总结</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="props-v2-6-11" tabindex="-1"><a class="header-anchor" href="#props-v2-6-11" aria-hidden="true">#</a> Props (v2.6.11)</h1><p><code>Props</code> 作为组件的核心特性之一，也是我们平时开发 Vue 项目中接触最多的特性之一，它可以让组件的功能变得丰富，也是父子组件通讯的一个渠道。那么它的实现原理是怎样的，我们来一探究竟。</p><h2 id="规范化" tabindex="-1"><a class="header-anchor" href="#规范化" aria-hidden="true">#</a> 规范化</h2><p>在初始化 <code>props</code> 之前，首先会对 <code>props</code> 做一次 <code>normalize</code>，它发生在 <code>mergeOptions</code> 的时候，在 <code>src/core/util/options.js</code> 中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mergeOptions</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">parent</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  <span class="token literal-property property">child</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Object <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">normalizeProps</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">normalizeProps</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">options</span><span class="token operator">:</span> Object<span class="token punctuation">,</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> <span class="token operator">?</span>Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> options<span class="token punctuation">.</span>props
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>props<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">let</span> i<span class="token punctuation">,</span> val<span class="token punctuation">,</span> name
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i <span class="token operator">=</span> props<span class="token punctuation">.</span>length
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      val <span class="token operator">=</span> props<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        name <span class="token operator">=</span> <span class="token function">camelize</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
        res<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&#39;props must be strings when using array syntax.&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      val <span class="token operator">=</span> props<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
      name <span class="token operator">=</span> <span class="token function">camelize</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      res<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
        <span class="token operator">?</span> val
        <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> val <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Invalid value for option &quot;props&quot;: expected an Array or an Object, </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">but got </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">toRawType</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  options<span class="token punctuation">.</span>props <span class="token operator">=</span> res
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>合并配置我们在组件化章节讲过，它主要就是处理我们定义组件的对象 <code>option</code>，然后挂载到组件的实例 <code>this.$options</code> 中。</p><p>我们接下来重点看 <code>normalizeProps</code> 的实现，其实这个函数的主要目的就是把我们编写的 <code>props</code> 转成对象格式，因为实际上 <code>props</code> 除了对象格式，还允许写成数组格式。</p><p>当 <code>props</code> 是一个数组，每一个数组元素 <code>prop</code> 只能是一个 <code>string</code>，表示 <code>prop</code> 的 <code>key</code>，转成驼峰格式，<code>prop</code> 的类型为空。</p><p>当 <code>props</code> 是一个对象，对于 <code>props</code> 中每个 <code>prop</code> 的 <code>key</code>，我们会转驼峰格式，而它的 <code>value</code>，如果不是一个对象，我们就把它规范成一个对象。</p><p>如果 <code>props</code> 既不是数组也不是对象，就抛出一个警告。</p><p>举个例子：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;nick-name&#39;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>经过 <code>normalizeProps</code> 后，会被规范成：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>options<span class="token punctuation">.</span>props <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">nickName</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">nickName</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Boolean
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>经过 <code>normalizeProps</code> 后，会被规范成：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>options<span class="token punctuation">.</span>props <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">nickName</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Boolean <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于对象形式的 <code>props</code> 可以指定每个 <code>prop</code> 的类型和定义其它的一些属性，推荐用对象形式定义 <code>props</code>。</p><h2 id="初始化" tabindex="-1"><a class="header-anchor" href="#初始化" aria-hidden="true">#</a> 初始化</h2><p><code>Props</code> 的初始化主要发生在 <code>new Vue</code> 中的 <code>initState</code> 阶段，在 <code>src/core/instance/state.js</code> 中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ....</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>


<span class="token keyword">function</span> <span class="token function">initProps</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> Component<span class="token punctuation">,</span> <span class="token literal-property property">propsOptions</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> propsData <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token comment">// cache prop keys so that future props updates can iterate using Array</span>
  <span class="token comment">// instead of dynamic object key enumeration.</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> isRoot <span class="token operator">=</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>$parent
  <span class="token comment">// root instance props should be converted</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> propsOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">validateProp</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> propsOptions<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token comment">/* istanbul ignore else */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> hyphenatedKey <span class="token operator">=</span> <span class="token function">hyphenate</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isReservedAttribute</span><span class="token punctuation">(</span>hyphenatedKey<span class="token punctuation">)</span> <span class="token operator">||</span>
          config<span class="token punctuation">.</span><span class="token function">isReservedAttr</span><span class="token punctuation">(</span>hyphenatedKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hyphenatedKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is a reserved attribute and cannot be used as component prop.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
          vm
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isUpdatingChildComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">warn</span><span class="token punctuation">(</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Avoid mutating a prop directly since the value will be </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">overwritten whenever the parent component re-renders. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Instead, use a data or computed property based on the prop&#39;s </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">value. Prop being mutated: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            vm
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// static props are already proxied on the component&#39;s prototype</span>
    <span class="token comment">// during Vue.extend(). We only need to proxy props defined at</span>
    <span class="token comment">// instantiation here.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_props</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>initProps</code> 主要做 3 件事情：校验、响应式和代理。</p><h3 id="校验" tabindex="-1"><a class="header-anchor" href="#校验" aria-hidden="true">#</a> 校验</h3><p>校验的逻辑很简单，遍历 <code>propsOptions</code>，执行 <code>validateProp(key, propsOptions, propsData, vm)</code> 方法。这里的 <code>propsOptions</code> 就是我们定义的 <code>props</code> 在规范后生成的 <code>options.props</code> 对象，<code>propsData</code> 是从父组件传递的 <code>prop</code> 数据。所谓校验的目的就是检查一下我们传递的数据是否满足 <code>prop </code>的定义规范。再来看一下 <code>validateProp</code> 方法，它定义在 <code>src/core/util/props.js</code> 中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">validateProp</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">key</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token literal-property property">propOptions</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  <span class="token literal-property property">propsData</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  vm<span class="token operator">?</span><span class="token operator">:</span> Component</span>
<span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span>
  <span class="token keyword">const</span> prop <span class="token operator">=</span> propOptions<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token keyword">const</span> absent <span class="token operator">=</span> <span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>propsData<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token keyword">let</span> value <span class="token operator">=</span> propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token comment">// boolean casting</span>
  <span class="token keyword">const</span> booleanIndex <span class="token operator">=</span> <span class="token function">getTypeIndex</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">,</span> prop<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>booleanIndex <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>absent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> <span class="token string">&#39;default&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">&#39;&#39;</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token function">hyphenate</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// only cast empty string / same name to boolean if</span>
      <span class="token comment">// boolean has higher priority</span>
      <span class="token keyword">const</span> stringIndex <span class="token operator">=</span> <span class="token function">getTypeIndex</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> prop<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>stringIndex <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> booleanIndex <span class="token operator">&lt;</span> stringIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// check default value</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value <span class="token operator">=</span> <span class="token function">getPropDefaultValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
    <span class="token comment">// since the default value is a fresh copy,</span>
    <span class="token comment">// make sure to observe it.</span>
    <span class="token keyword">const</span> prevShouldObserve <span class="token operator">=</span> shouldObserve
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span>prevShouldObserve<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">&amp;&amp;</span>
    <span class="token comment">// skip validation for weex recycle-list child component props</span>
    <span class="token operator">!</span><span class="token punctuation">(</span>__WEEX__ <span class="token operator">&amp;&amp;</span> <span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token string">&#39;@binding&#39;</span> <span class="token keyword">in</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">assertProp</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> absent<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> value
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>validateProp</code> 主要就做 3 件事情：处理 <code>Boolean</code> 类型的数据，处理默认数据，<code>prop</code> 断言，并最终返回 <code>prop</code> 的值。</p><p>先来看 <code>Boolean</code> 类型数据的处理逻辑：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> prop <span class="token operator">=</span> propOptions<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
<span class="token keyword">const</span> absent <span class="token operator">=</span> <span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>propsData<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token keyword">let</span> value <span class="token operator">=</span> propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
<span class="token comment">// boolean casting</span>
<span class="token keyword">const</span> booleanIndex <span class="token operator">=</span> <span class="token function">getTypeIndex</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">,</span> prop<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>booleanIndex <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>absent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> <span class="token string">&#39;default&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token string">&#39;&#39;</span> <span class="token operator">||</span> value <span class="token operator">===</span> <span class="token function">hyphenate</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// only cast empty string / same name to boolean if</span>
    <span class="token comment">// boolean has higher priority</span>
    <span class="token keyword">const</span> stringIndex <span class="token operator">=</span> <span class="token function">getTypeIndex</span><span class="token punctuation">(</span>String<span class="token punctuation">,</span> prop<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stringIndex <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> booleanIndex <span class="token operator">&lt;</span> stringIndex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      value <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>先通过 <code>const booleanIndex = getTypeIndex(Boolean, prop.type)</code> 来判断 <code>prop</code> 的定义是否是 <code>Boolean</code> 类型的。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getType</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> match <span class="token operator">=</span> fn <span class="token operator">&amp;&amp;</span> fn<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s*function (\w+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> match <span class="token operator">?</span> match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">isSameType</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">getType</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">getType</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">getTypeIndex</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> expectedTypes</span><span class="token punctuation">)</span><span class="token operator">:</span> number <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>expectedTypes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">isSameType</span><span class="token punctuation">(</span>expectedTypes<span class="token punctuation">,</span> type<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> expectedTypes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameType</span><span class="token punctuation">(</span>expectedTypes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> i
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>getTypeIndex</code> 函数就是找到 <code>type</code> 和 <code>expectedTypes</code> 匹配的索引并返回。</p><p><code>prop</code> 类型定义的时候可以是某个原生构造函数，也可以是原生构造函数的数组，比如：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">,</span> Boolean<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果 <code>expectedTypes</code> 是单个构造函数，就执行 <code>isSameType</code> 去判断是否是同一个类型；如果是数组，那么就遍历这个数组，找到第一个同类型的，返回它的索引。</p><p>回到 <code>validateProp</code> 函数，通过 <code>const booleanIndex = getTypeIndex(Boolean, prop.type)</code> 得到 <code>booleanIndex</code>，如果 <code>prop.type</code> 是一个 <code>Boolean</code> 类型，则通过 <code>absent &amp;&amp; !hasOwn(prop, &#39;default&#39;)</code> 来判断如果父组件没有传递这个 <code>prop</code> 数据并且没有设置 <code>default</code> 的情况，则 <code>value</code> 为 false。</p><p>接着判断<code>value === &#39;&#39; || value === hyphenate(key)</code> 的情况，如果满足则先通过 <code>const stringIndex = getTypeIndex(String, prop.type)</code> 获取匹配 <code>String</code> 类型的索引，然后判断 <code>stringIndex &lt; 0 || booleanIndex &lt; stringIndex</code> 的值来决定 <code>value</code> 的值是否为 <code>true</code>。这块逻辑稍微有点绕，我们举 2 个例子来说明：</p><p>例如你定义一个组件 <code>Student</code>:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
  <span class="token literal-property property">nickName</span><span class="token operator">:</span> <span class="token punctuation">[</span>Boolean<span class="token punctuation">,</span> String<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后在父组件中引入这个组件：</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>student</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Kate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">nick-name</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>student</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>或者是：</p><div class="language-vue line-numbers-mode" data-ext="vue"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>student</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Kate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">nick-name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nick-name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>student</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第一种情况没有写属性的值，满足 <code>value === &#39;&#39;</code>，第二种满足 <code>value === hyphenate(key)</code> 的情况，另外 <code>nickName</code> 这个 <code>prop</code> 的类型是 <code>Boolean</code> 或者是 <code>String</code>，并且满足 <code>booleanIndex &lt; stringIndex</code>，所以对 <code>nickName</code> 这个 <code>prop</code> 的 <code>value</code> 为 <code>true</code>。</p><p>接下来看一下默认数据处理逻辑：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// check default value</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  value <span class="token operator">=</span> <span class="token function">getPropDefaultValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token comment">// since the default value is a fresh copy,</span>
  <span class="token comment">// make sure to observe it.</span>
  <span class="token keyword">const</span> prevShouldObserve <span class="token operator">=</span> shouldObserve
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token function">observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span>prevShouldObserve<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当 <code>value</code> 的值为 <code>undefined</code> 的时候，说明父组件根本就没有传这个 <code>prop</code>，那么我们就需要通过 <code>getPropDefaultValue(vm, prop, key)</code> 获取这个 <code>prop</code> 的默认值。我们这里只关注 <code>getPropDefaultValue</code> 的实现，<code>toggleObserving</code> 和 <code>observe</code> 的作用我们之后会说。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getPropDefaultValue</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> <span class="token operator">?</span>Component<span class="token punctuation">,</span> <span class="token literal-property property">prop</span><span class="token operator">:</span> PropOptions<span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> any <span class="token punctuation">{</span>
  <span class="token comment">// no default, return undefined</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> <span class="token string">&#39;default&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">undefined</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> def <span class="token operator">=</span> prop<span class="token punctuation">.</span>default
  <span class="token comment">// warn against non-factory defaults for Object &amp; Array</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isObject</span><span class="token punctuation">(</span>def<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">&#39;Invalid default value for prop &quot;&#39;</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">&#39;&quot;: &#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;Props with type Object/Array must use a factory function &#39;</span> <span class="token operator">+</span>
      <span class="token string">&#39;to return the default value.&#39;</span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// the raw prop value was also undefined from previous render,</span>
  <span class="token comment">// return previous default value to avoid unnecessary watcher trigger</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">&amp;&amp;</span>
    vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span>
    vm<span class="token punctuation">.</span>_props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> vm<span class="token punctuation">.</span>_props<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// call factory function for non-Function types</span>
  <span class="token comment">// a value is Function if its prototype is function even across different execution context</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> def <span class="token operator">===</span> <span class="token string">&#39;function&#39;</span> <span class="token operator">&amp;&amp;</span> <span class="token function">getType</span><span class="token punctuation">(</span>prop<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">&#39;Function&#39;</span>
    <span class="token operator">?</span> <span class="token function">def</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
    <span class="token operator">:</span> def
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检测如果 <code>prop</code> 没有定义 <code>default</code> 属性，那么返回 <code>undefined</code>，通过这块逻辑我们知道除了 <code>Boolean</code> 类型的数据，其余没有设置 <code>default</code> 属性的 <code>prop</code> 默认值都是 <code>undefined</code>。</p><p>接着是开发环境下对 <code>prop</code> 的默认值是否为对象或者数组类型的判断，如果是的话会报警告，因为对象和数组类型的 <code>prop</code>，他们的默认值必须要返回一个工厂函数。</p><p>接下来的判断是如果上一次组件渲染父组件传递的 <code>prop</code> 的值是 <code>undefined</code>，则直接返回 上一次的默认值 <code>vm._props[key]</code>，这样可以避免触发不必要的 <code>watcher</code> 的更新。</p><p>最后就是判断 <code>def</code> 如果是工厂函数且 <code>prop</code> 的类型不是 <code>Function</code> 的时候，返回工厂函数的返回值，否则直接返回 <code>def</code>。</p><p>至此，我们讲完了 <code>validateProp</code> 函数的 <code>Boolean</code> 类型数据的处理逻辑和默认数据处理逻辑，最后来看一下 <code>prop</code> 断言逻辑。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>
process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">&amp;&amp;</span>
<span class="token comment">// skip validation for weex recycle-list child component props</span>
<span class="token operator">!</span><span class="token punctuation">(</span>__WEEX__ <span class="token operator">&amp;&amp;</span> <span class="token function">isObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token string">&#39;@binding&#39;</span> <span class="token keyword">in</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">assertProp</span><span class="token punctuation">(</span>prop<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> vm<span class="token punctuation">,</span> absent<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在开发环境且非 <code>weex</code> 的某种环境下，执行 <code>assertProp</code> 做属性断言。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">assertProp</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">prop</span><span class="token operator">:</span> PropOptions<span class="token punctuation">,</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  <span class="token literal-property property">vm</span><span class="token operator">:</span> <span class="token operator">?</span>Component<span class="token punctuation">,</span>
  <span class="token literal-property property">absent</span><span class="token operator">:</span> boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>prop<span class="token punctuation">.</span>required <span class="token operator">&amp;&amp;</span> absent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token string">&#39;Missing required prop: &quot;&#39;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&#39;&quot;&#39;</span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>prop<span class="token punctuation">.</span>required<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> type <span class="token operator">=</span> prop<span class="token punctuation">.</span>type
  <span class="token keyword">let</span> valid <span class="token operator">=</span> <span class="token operator">!</span>type <span class="token operator">||</span> type <span class="token operator">===</span> <span class="token boolean">true</span>
  <span class="token keyword">const</span> expectedTypes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      type <span class="token operator">=</span> <span class="token punctuation">[</span>type<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> type<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>valid<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> assertedType <span class="token operator">=</span> <span class="token function">assertType</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> type<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
      expectedTypes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>assertedType<span class="token punctuation">.</span>expectedType <span class="token operator">||</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span>
      valid <span class="token operator">=</span> assertedType<span class="token punctuation">.</span>valid
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token function">getInvalidTypeMessage</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> expectedTypes<span class="token punctuation">)</span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> validator <span class="token operator">=</span> prop<span class="token punctuation">.</span>validator
  <span class="token keyword">if</span> <span class="token punctuation">(</span>validator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">validator</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token string">&#39;Invalid prop: custom validator check failed for prop &quot;&#39;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&#39;&quot;.&#39;</span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>assertProp</code> 函数的目的是断言这个 <code>prop</code> 是否合法。</p><p>首先判断如果 <code>prop</code> 定义了 <code>required</code> 属性但父组件没有传递这个 <code>prop</code> 数据的话会报一个警告。</p><p>接着判断如果 <code>value</code> 为空且 <code>prop</code> 没有定义 <code>required</code> 属性则直接返回。</p><p>然后再去对 <code>prop</code> 的类型做校验，先是拿到 <code>prop</code> 中定义的类型 <code>type</code>，并尝试把它转成一个类型数组，然后依次遍历这个数组，执行 <code>assertType(value, type[i])</code> 去获取断言的结果，直到遍历完成或者是 <code>valid</code> 为 <code>true</code> 的时候跳出循环。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> simpleCheckRE <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(String|Number|Boolean|Function|Symbol)$</span><span class="token regex-delimiter">/</span></span>
<span class="token keyword">function</span> <span class="token function">assertType</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Function</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">valid</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span>
  <span class="token literal-property property">expectedType</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> valid
  <span class="token keyword">const</span> expectedType <span class="token operator">=</span> <span class="token function">getType</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>simpleCheckRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>expectedType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> t <span class="token operator">=</span> <span class="token keyword">typeof</span> value
    valid <span class="token operator">=</span> t <span class="token operator">===</span> expectedType<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// for primitive wrapper objects</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>valid <span class="token operator">&amp;&amp;</span> t <span class="token operator">===</span> <span class="token string">&#39;object&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      valid <span class="token operator">=</span> value <span class="token keyword">instanceof</span> <span class="token class-name">type</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>expectedType <span class="token operator">===</span> <span class="token string">&#39;Object&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    valid <span class="token operator">=</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>expectedType <span class="token operator">===</span> <span class="token string">&#39;Array&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    valid <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    valid <span class="token operator">=</span> value <span class="token keyword">instanceof</span> <span class="token class-name">type</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    valid<span class="token punctuation">,</span>
    expectedType
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>assertType</code> 的逻辑很简单，先通过 <code>getType(type)</code> 获取 <code>prop</code> 期望的类型 <code>expectedType</code>，然后再去根据几种不同的情况对比 <code>prop</code> 的值 <code>value</code> 是否和 <code>expectedType</code> 匹配，最后返回匹配的结果。</p><p>如果循环结束后 <code>valid</code> 仍然为 <code>false</code>，那么说明 <code>prop</code> 的值 <code>value</code> 与 <code>prop</code> 定义的类型都不匹配，那么就会输出一段通过 <code>getInvalidTypeMessage(name, value, expectedTypes)</code> 生成的警告信息，就不细说了。</p><p>最后判断当 <code>prop</code> 自己定义了 <code>validator</code> 自定义校验器，则执行 <code>validator</code> 校验器方法，如果校验不通过则输出警告信息。</p><h3 id="响应式" tabindex="-1"><a class="header-anchor" href="#响应式" aria-hidden="true">#</a> 响应式</h3><p>回到 <code>initProps</code> 方法，当我们通过 <code>const value = validateProp(key, propsOptions, propsData, vm)</code> 对 <code>prop</code> 做验证并且获取到 <code>prop</code> 的值后，接下来需要通过 <code>defineReactive</code> 把 <code>prop</code> 变成响应式。</p><p><code>defineReactive</code> 我们之前已经介绍过，这里要注意的是，在开发环境中我们会校验 <code>prop</code> 的 <code>key</code> 是否是 <code>HTML</code> 的保留属性，并且在 <code>defineReactive</code> 的时候会添加一个自定义 <code>setter</code>，当我们直接对 <code>prop</code> 赋值的时候会输出警告：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> hyphenatedKey <span class="token operator">=</span> <span class="token function">hyphenate</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isReservedAttribute</span><span class="token punctuation">(</span>hyphenatedKey<span class="token punctuation">)</span> <span class="token operator">||</span>
      config<span class="token punctuation">.</span><span class="token function">isReservedAttr</span><span class="token punctuation">(</span>hyphenatedKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hyphenatedKey<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; is a reserved attribute and cannot be used as component prop.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      vm
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">defineReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>isUpdatingChildComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">warn</span><span class="token punctuation">(</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Avoid mutating a prop directly since the value will be </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">overwritten whenever the parent component re-renders. </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Instead, use a data or computed property based on the prop&#39;s </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">value. Prop being mutated: &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        vm
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>关于 <code>prop</code> 的响应式有一点不同的是当 <code>vm</code> 是非根实例的时候，会先执行 <code>toggleObserving(false)</code>，它的目的是为了响应式的优化，我们先跳过，之后会详细说明。</p><h3 id="代理" tabindex="-1"><a class="header-anchor" href="#代理" aria-hidden="true">#</a> 代理</h3><p>在经过响应式处理后，我们会把 <code>prop</code> 的值添加到 <code>vm._props</code> 中，比如 key 为 <code>name</code> 的 <code>prop</code>，它的值保存在 <code>vm._props.name</code> 中，但是我们在组件中可以通过 <code>this.name</code> 访问到这个 <code>prop</code>，这就是代理做的事情。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// static props are already proxied on the component&#39;s prototype</span>
<span class="token comment">// during Vue.extend(). We only need to proxy props defined at</span>
<span class="token comment">// instantiation here.</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">proxy</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_props</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过 <code>proxy</code> 函数实现了上述需求。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> sharedPropertyDefinition <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">get</span><span class="token operator">:</span> noop<span class="token punctuation">,</span>
  <span class="token literal-property property">set</span><span class="token operator">:</span> noop
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">proxy</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">target</span><span class="token operator">:</span> Object<span class="token punctuation">,</span> <span class="token literal-property property">sourceKey</span><span class="token operator">:</span> string<span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxyGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  sharedPropertyDefinition<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">proxySetter</span> <span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">[</span>sourceKey<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val
  <span class="token punctuation">}</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> sharedPropertyDefinition<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当访问 <code>this.name</code> 的时候就相当于访问 <code>this._props.name</code>。</p><p>其实对于非根实例的子组件而言，<code>prop</code> 的代理发生在 <code>Vue.extend</code> 阶段，在 <code>src/core/global-api/extend.js</code> 中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Vue<span class="token punctuation">.</span><span class="token function-variable function">extend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">extendOptions</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span><span class="token operator">:</span> Function <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> <span class="token function-variable function">Sub</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">VueComponent</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>

  <span class="token comment">// For props and computed properties, we define the proxy getters on</span>
  <span class="token comment">// the Vue instances at extension time, on the extended prototype. This</span>
  <span class="token comment">// avoids Object.defineProperty calls for each instance created.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initProps</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Sub<span class="token punctuation">.</span>options<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initComputed</span><span class="token punctuation">(</span>Sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> Sub
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">initProps</span> <span class="token punctuation">(</span><span class="token parameter">Comp</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> Comp<span class="token punctuation">.</span>options<span class="token punctuation">.</span>props
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token class-name">Comp</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_props</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这么做的好处是不用为每个组件实例都做一层 <code>proxy</code>，是一种优化手段。</p><h2 id="props-更新" tabindex="-1"><a class="header-anchor" href="#props-更新" aria-hidden="true">#</a> Props 更新</h2><p>我们知道，当父组件传递给子组件的 <code>props</code> 值变化，子组件对应的值也会改变，同时会触发子组件的重新渲染。那么接下来我们就从源码角度来分析这两个过程。</p><h3 id="子组件-props-更新" tabindex="-1"><a class="header-anchor" href="#子组件-props-更新" aria-hidden="true">#</a> 子组件 props 更新</h3><p>首先，<code>prop</code> 数据的值变化在父组件，我们知道在父组件的 <code>render</code> 过程中会访问到这个 <code>prop</code> 数据，所以当 <code>prop</code> 数据变化一定会触发父组件的重新渲染，那么重新渲染是如何更新子组件对应的 <code>prop</code> 的值呢？</p><p>在父组件重新渲染的最后，会执行 <code>patch</code> 过程，进而执行 <code>patchVnode</code> 函数，<code>patchVnode</code> 通常是一个递归过程，当它遇到组件 <code>vnode</code> 的时候，会执行组件更新过程的 <code>prepatch</code> 钩子函数，在 <code>src/core/vdom/patch.js</code> 中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">patchVnode</span> <span class="token punctuation">(</span>
  <span class="token parameter">oldVnode<span class="token punctuation">,</span>
  vnode<span class="token punctuation">,</span>
  insertedVnodeQueue<span class="token punctuation">,</span>
  ownerArray<span class="token punctuation">,</span>
  index<span class="token punctuation">,</span>
  removeOnly</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  <span class="token keyword">let</span> i
  <span class="token keyword">const</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isDef</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> data<span class="token punctuation">.</span>hook<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isDef</span><span class="token punctuation">(</span>i <span class="token operator">=</span> i<span class="token punctuation">.</span>prepatch<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">i</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>prepatch</code> 函数定义在 <code>src/core/vdom/create-component.js</code> 中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">prepatch</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">oldVnode</span><span class="token operator">:</span> MountedComponentVNode<span class="token punctuation">,</span> <span class="token literal-property property">vnode</span><span class="token operator">:</span> MountedComponentVNode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> vnode<span class="token punctuation">.</span>componentOptions
  <span class="token keyword">const</span> child <span class="token operator">=</span> vnode<span class="token punctuation">.</span>componentInstance <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>componentInstance
  <span class="token function">updateChildComponent</span><span class="token punctuation">(</span>
    child<span class="token punctuation">,</span>
    options<span class="token punctuation">.</span>propsData<span class="token punctuation">,</span> <span class="token comment">// updated props</span>
    options<span class="token punctuation">.</span>listeners<span class="token punctuation">,</span> <span class="token comment">// updated listeners</span>
    vnode<span class="token punctuation">,</span> <span class="token comment">// new parent vnode</span>
    options<span class="token punctuation">.</span>children <span class="token comment">// new children</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>内部会调用 <code>updateChildComponent</code> 方法来更新 <code>props</code>，注意第二个参数就是父组件的 <code>propData</code>，那么为什么 <code>vnode.componentOptions.propsData</code> 就是父组件传递给子组件的 <code>prop</code> 数据呢（这个也同样解释了第一次渲染的 <code>propsData</code> 来源）？原来在组件的 <code>render</code> 过程中，对于组件节点会通过 <code>createComponent</code> 方法来创建组件 <code>vnode</code>：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createComponent</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">Ctor</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span> <span class="token operator">|</span> Function <span class="token operator">|</span> Object <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token operator">?</span>VNodeData<span class="token punctuation">,</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> Component<span class="token punctuation">,</span>
  <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  tag<span class="token operator">?</span><span class="token operator">:</span> string</span>
<span class="token punctuation">)</span><span class="token operator">:</span> VNode <span class="token operator">|</span> Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span> <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  <span class="token comment">// extract props</span>
  <span class="token keyword">const</span> propsData <span class="token operator">=</span> <span class="token function">extractPropsFromVNodeData</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> Ctor<span class="token punctuation">,</span> tag<span class="token punctuation">)</span>

  <span class="token comment">// ...</span>
  
  <span class="token keyword">const</span> vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">vue-component-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Ctor<span class="token punctuation">.</span>cid<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">&#39;&#39;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    data<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> context<span class="token punctuation">,</span>
    <span class="token punctuation">{</span> Ctor<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> listeners<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> children <span class="token punctuation">}</span><span class="token punctuation">,</span>
    asyncFactory
  <span class="token punctuation">)</span>

  <span class="token comment">// ...</span>
  
  <span class="token keyword">return</span> vnode
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在创建组件 <code>vnode</code> 的过程中，首先从 <code>data</code> 中提取出 <code>propData</code>，然后在 <code>new VNode</code> 的时候，作为第七个参数 <code>VNodeComponentOptions</code> 中的一个属性传入，所以我们可以通过 <code>vnode.componentOptions.propsData</code> 拿到 <code>prop</code> 数据。</p><p>接着看 <code>updateChildComponent</code> 函数，它的定义在 <code>src/core/instance/lifecycle.js</code> 中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">updateChildComponent</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> Component<span class="token punctuation">,</span>
  <span class="token literal-property property">propsData</span><span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  <span class="token literal-property property">listeners</span><span class="token operator">:</span> <span class="token operator">?</span>Object<span class="token punctuation">,</span>
  <span class="token literal-property property">parentVnode</span><span class="token operator">:</span> MountedComponentVNode<span class="token punctuation">,</span>
  <span class="token literal-property property">renderChildren</span><span class="token operator">:</span> <span class="token operator">?</span>Array<span class="token operator">&lt;</span>VNode<span class="token operator">&gt;</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>

  <span class="token comment">// update props</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>propsData <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props
    <span class="token keyword">const</span> propKeys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> propKeys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> key <span class="token operator">=</span> propKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">const</span> <span class="token literal-property property">propOptions</span><span class="token operator">:</span> any <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props <span class="token comment">// wtf flow?</span>
      props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">validateProp</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> propOptions<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token comment">// keep a copy of raw propsData</span>
    vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">=</span> propsData
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们重点来看更新 <code>props</code> 的相关逻辑，这里的 <code>propsData</code> 是父组件传递的 <code>props</code> 数据，<code>vm</code> 是子组件的实例。<code>vm._props</code> 指向的就是子组件的 <code>props</code> 值，<code>propKeys</code> 就是在之前 <code>initProps</code> 过程中，缓存的子组件中定义的所有 <code>prop</code> 的 <code>key</code>。主要逻辑就是遍历 <code>propKeys</code>，然后执行 <code>props[key] = validateProp(key, propOptions, propsData, vm)</code> 重新验证和计算新的 <code>prop</code> 数据，更新 <code>vm._props</code>，也就是子组件的 <code>props</code>，这个就是子组件 <code>props</code> 的更新过程。</p><h3 id="子组件重新渲染" tabindex="-1"><a class="header-anchor" href="#子组件重新渲染" aria-hidden="true">#</a> 子组件重新渲染</h3><p>其实子组件的重新渲染有 2 种情况，一个是 <code>prop</code> 值被修改，另一个是对象类型的 <code>prop</code> 内部属性的变化。</p><p>先来看一下 <code>prop</code> 值被修改的情况，当执行 <code>props[key] = validateProp(key, propOptions, propsData, vm)</code> 更新子组件 <code>prop</code> 的时候，会触发 <code>prop</code> 的 <code>setter</code> 过程，只要在渲染子组件的时候访问过这个 <code>prop</code> 值，那么根据响应式原理，就会触发子组件的重新渲染。</p><p>再来看一下当对象类型的 <code>prop</code> 的内部属性发生变化的时候，这个时候其实并没有触发子组件 <code>prop</code> 的更新。但是在子组件的渲染过程中，访问过这个对象 <code>prop</code>，所以这个对象 <code>prop</code> 在触发 <code>getter</code> 的时候会把子组件的 <code>render watcher</code> 收集到依赖中，然后当我们在父组件更新这个对象 <code>prop</code> 的某个属性的时候，会触发 <code>setter</code> 过程，也就会通知子组件 <code>render watcher</code> 的 <code>update</code>，进而触发子组件的重新渲染。</p><p>以上就是当父组件 <code>props</code> 更新，触发子组件重新渲染的 2 种情况。</p><h2 id="toggleobserving" tabindex="-1"><a class="header-anchor" href="#toggleobserving" aria-hidden="true">#</a> toggleObserving</h2><p>最后我们在来聊一下 <code>toggleObserving</code>，它的定义在 <code>src/core/observer/index.js</code> 中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">let</span> <span class="token literal-property property">shouldObserve</span><span class="token operator">:</span> boolean <span class="token operator">=</span> <span class="token boolean">true</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">toggleObserving</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> boolean</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  shouldObserve <span class="token operator">=</span> value
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>它在当前模块中定义了 <code>shouldObserve</code> 变量，用来控制在 <code>observe</code> 的过程中是否需要把当前值变成一个 <code>Observer</code> 对象。</p><p>那么为什么在 <code>props</code> 的初始化和更新过程中，多次执行 <code>toggleObserving(false)</code> 呢，接下来我们就来分析这几种情况。</p><p>在 <code>initProps</code> 的过程中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> isRoot <span class="token operator">=</span> <span class="token operator">!</span>vm<span class="token punctuation">.</span>$parent
<span class="token comment">// root instance props should be converted</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isRoot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> propsOptions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">validateProp</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> propsOptions<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
  <span class="token function">defineReactive</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>对于非根实例的情况，我们会执行 <code>toggleObserving(false)</code>，然后对于每一个 <code>prop</code> 值，去执行 <code>defineReactive(props, key, value)</code> 去把它变成响应式。</p><p>回顾一下 <code>defineReactive</code> 的定义：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">obj</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token literal-property property">val</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  customSetter<span class="token operator">?</span><span class="token operator">:</span> <span class="token operator">?</span>Function<span class="token punctuation">,</span>
  shallow<span class="token operator">?</span><span class="token operator">:</span> boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  
  <span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span> <span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通常对于值 <code>val</code> 会执行 <code>observe</code> 函数，然后遇到 <code>val</code> 是对象或者数组的情况会递归执行 <code>defineReactive</code> 把它们的子属性都变成响应式的，但是由于 <code>shouldObserve</code> 的值变成了 <code>false</code>，这个递归过程被省略了。为什么会这样呢？</p><p>因为正如我们前面分析的，对于对象的 <code>prop</code> 值，子组件的 <code>prop</code> 值始终指向父组件的 <code>prop</code> 值，只要父组件的 <code>prop</code> 值变化，就会触发子组件的重新渲染，所以这个 <code>observe</code> 过程是可以省略的。</p><p>最后再执行 <code>toggleObserving(true)</code> 恢复 <code>shouldObserve</code> 为 <code>true</code>。</p><p>在 <code>validateProp</code> 的过程中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// check default value</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  value <span class="token operator">=</span> <span class="token function">getPropDefaultValue</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
  <span class="token comment">// since the default value is a fresh copy,</span>
  <span class="token comment">// make sure to observe it.</span>
  <span class="token keyword">const</span> prevShouldObserve <span class="token operator">=</span> shouldObserve
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token function">observe</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span>prevShouldObserve<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这种是父组件没有传递 <code>prop</code> 值对默认值的处理逻辑，因为这个值是一个拷贝，所以我们需要 <code>toggleObserving(true)</code>，然后执行 <code>observe(value)</code> 把值变成响应式。</p><p>在 <code>updateChildComponent</code> 过程中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// update props</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>propsData <span class="token operator">&amp;&amp;</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> props <span class="token operator">=</span> vm<span class="token punctuation">.</span>_props
  <span class="token keyword">const</span> propKeys <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>_propKeys <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> propKeys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> key <span class="token operator">=</span> propKeys<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token keyword">const</span> <span class="token literal-property property">propOptions</span><span class="token operator">:</span> any <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>props <span class="token comment">// wtf flow?</span>
    props<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">validateProp</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> propOptions<span class="token punctuation">,</span> propsData<span class="token punctuation">,</span> vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">toggleObserving</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token comment">// keep a copy of raw propsData</span>
  vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>propsData <span class="token operator">=</span> propsData
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其实和 <code>initProps</code> 的逻辑一样，不需要对引用类型 <code>props</code> 递归做响应式处理，所以也需要 <code>toggleObserving(false)</code>。</p><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p>通过这一节的分析，我们了解了 <code>props</code> 的规范化、初始化、更新等过程的实现原理；也了解了 Vue 内部对 <code>props</code> 如何做响应式的优化；同时还了解到 <code>props</code> 的变化是如何触发子组件的更新。了解这些对我们平时对 <code>props</code> 的应用，遇到问题时的定位追踪会有很大的帮助。</p></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://gitee.com/mpbug/mpbug/edit/main/views/Books/Front-end/JustVue2/reactive/props.md" rel="noopener noreferrer" target="_blank" aria-label="在 GitHub 上编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->在 GitHub 上编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><!----><!----></div></footer><nav class="page-nav"><a href="/views/Books/Front-end/JustVue2/reactive/component-update.html" class="nav-link prev" aria-label="组件更新"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><!---->组件更新</div></a><a href="/views/Books/Front-end/JustVue2/reactive/summary.html" class="nav-link next" aria-label="原理图"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">原理图<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">收纳万物的时空葫芦、变幻万物的魔法葫芦</div><div class="copyright">Copyright © 2023 魔法时空宝库</div></footer></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-724d8966.js" defer></script>
  </body>
</html>
